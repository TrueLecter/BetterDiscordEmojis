(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){},{}],2:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:3}],3:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],4:[function(require,module,exports){"use strict";const{getClasses:getClasses}=require("./helpers.js");const{SWITCH_CLASSES:SWITCH_CLASSES,FLEX_CHILD_CLASSES:FLEX_CHILD_CLASSES,FLEX_CLASSES:FLEX_CLASSES,HEADER_CLASSES:HEADER_CLASSES,SWITCH_ITEM_CLASSES:SWITCH_ITEM_CLASSES,DIVIDER_ITEM_CLASSES:DIVIDER_ITEM_CLASSES,LABEL_ITEM_CLASSES:LABEL_ITEM_CLASSES,FONT_SIZE_CLASSES:FONT_SIZE_CLASSES}=require("./classes.js");function checkbox({setting:setting,name:name,description:description,value:value,change:change}){return $(`\n\t\t<div class="${[FLEX_CHILD_CLASSES.flex,getClasses(FLEX_CLASSES,["vertical","justifyStart","alignStretch","noWrap"])].join(" ")}" style="flex: 1 1 auto;">\n\t\t\t<div class="${[getClasses(FLEX_CHILD_CLASSES,["flex","horizontal"]),getClasses(FLEX_CLASSES,["justifyStart","alignStart","noWrap"])].join(" ")}" style="flex: 1 1 auto;">\n\t\t\t\t<h3 class="${[getClasses(HEADER_CLASSES,["h3","defaultColor"]),SWITCH_ITEM_CLASSES.title,FLEX_CHILD_CLASSES.flexChild].join(" ")}" style="flex: 1 1 auto;">\n\t\t\t\t\t${name}\n\t\t\t\t</h3>\n\t\t\t\t<div class="${SWITCH_CLASSES.switchWrapperDefaultActive} ${FLEX_CHILD_CLASSES.flexChild}" style="flex: 0 0 auto;">\n\t\t\t\t\t<input type="checkbox" class="${SWITCH_CLASSES.checkbox}" value="on">\n\t\t\t\t\t<div class="${SWITCH_CLASSES.switch} ${value?SWITCH_CLASSES.checked:""}"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="${[LABEL_ITEM_CLASSES.description,SWITCH_ITEM_CLASSES.note,LABEL_ITEM_CLASSES.modeDefault,FONT_SIZE_CLASSES.primary].join(" ")}" style="flex: 1 1 auto; ${description?"":"display: none;"}">\n\t\t\t\t${description}\n\t\t\t</div>\n\t\t\t<div class="${DIVIDER_ITEM_CLASSES.divider} ${SWITCH_ITEM_CLASSES.divider}"></div>\n\t\t</div>\n\t\t`).on("click",function(){const $this=$(this).find(`.${SWITCH_CLASSES.switch}`);$this.toggleClass(SWITCH_CLASSES.checked);if(typeof change==="function"){change($this.hasClass(SWITCH_CLASSES.checked))}})}module.exports=checkbox},{"./classes.js":5,"./helpers.js":8}],5:[function(require,module,exports){"use strict";exports.SETTINGS_CLASSES=n(2392);exports.SWITCH_CLASSES=n(2390);exports.FLEX_CHILD_CLASSES=n(2374);exports.FLEX_CLASSES=n(2355);exports.HEADER_CLASSES=n(2401);exports.SWITCH_ITEM_CLASSES=n(2391);exports.DIVIDER_ITEM_CLASSES=n(2397);exports.LABEL_ITEM_CLASSES=n(2400);exports.FONT_SIZE_CLASSES=n(2393);exports.CARD_CLASSES=n(2366);exports.SIDEBAR_BUTTON_CLASS="be-settings-button";exports.SERVER_CARD_CLASSES={showInPicker:"be-server-show-in-picker",showInPickerSwitch:"be-server-show-in-picker-switch",showInServerList:"be-server-show-in-server-list",showInServerListSwitch:"be-server-show-in-server-list-switch",serverCard:"be-server-card",icon:"be-server-icon"};function n(id){return webpackJsonp([],[],[id])}},{}],6:[function(require,module,exports){"use strict";exports.API_BASE="https://discordapp.com/api";exports.EMOJI_PICKER_PATH="#app-mount > div > div:nth-child(7)";exports.EMOJI_BUTTON_CLASS=n(2367).emojiButton;exports.CHANNEL_TEXTAREA_CLASS=n(2367).channelTextArea;exports.LOCAL_STORAGE_MODULE=n(1786);exports.EMOJI_STORAGE_MODULE=n(174).default;exports.STANDART_EMOJI_CLASS=n(174).Emoji;exports.SERVERS_STORAGE_MODULE=n(15);exports.SERVERS_PERMISSIONS_MODULE=n(58);exports.TRANSLATION_MODULE=n(3);exports.CUSTOM_EMOJI_STORAGE_MODULE=n(204);exports.TOKEN_KEY=n(0).TOKEN_KEY;exports.EMOJI_ROW_CATEGORY_HEIGHT=32;exports.ELEMENT_SCROLLER_WRAP='<div class="scroller-wrap tl-emoji-scroller-wrap"><div class="scroller"></div></div>';exports.ELEMENT_SEARCH_INPUT='<input type="text" placeholder="Find the perfect emoji" value="">';exports.ELEMENT_SERVER_EMOJI_LIST='<span class="server-emojis"><div class="category">server.name</div></span>';exports.ELEMENT_SERVER_EMOJI_LIST_ROW='<div class="row"></div>';exports.ELEMENT_SERVER_EMOJI_LIST_ROW_ENTRY='<div class="emoji-item"></div>';exports.REACTION_POPOUT_REGEX=/TOGGLE_REACTION_POPOUT_(\d+)/;exports.CURRENT_SELECTED_CHANNEL_REGEX=/.*\/.+\/(\d+)/;exports.IS_INBOX_REGEX=/\/channels\/@me\/\d+/;exports.IS_NUMBER_REGEX=/\d+/;exports.BETTER_EMOJIS_KEY="better-emojis";exports.defaultFetchOptions={method:"GET"};function n(id){return webpackJsonp([],[],[id])}},{}],7:[function(require,module,exports){"use strict";const id=Symbol("id");const name=Symbol("name");const url=Symbol("url");const managed=Symbol("managed");const requireColons=Symbol("requireColons");const roles=Symbol("roles");const GLOBAL_EMOJI_MAP=new Map;const NUMBER_REGEX=/^\d+$/;class Emoji{constructor(_id,_name,_managed=false,_requireColons=true,_roles=[],_url=`https://cdn.discordapp.com/emojis/${_id}.png`){this[id]=_id;this[name]=_name;this[url]=_url;this[managed]=_managed;this[requireColons]=_requireColons;this[roles]=_roles;GLOBAL_EMOJI_MAP.set(this[id],this)}get id(){return this[id]}get name(){return this[name]}get url(){return this[url]}get isManaged(){return this[managed]}get require_colons(){return this[requireColons]}get colonsRequired(){return this[requireColons]}get roles(){return this[roles]}get useName(){return this.colonsRequired?`:${this.name}:`:this.name}isCustom(){return NUMBER_REGEX.test(this[id])}static fromRaw(emojiRaw){return new Emoji(emojiRaw.id,emojiRaw.name,emojiRaw.managed,emojiRaw.requireColons,emojiRaw.roles)}static getById(id){return GLOBAL_EMOJI_MAP.get(id)}}module.exports=Emoji},{}],8:[function(require,module,exports){"use strict";const{defaultFetchOptions:defaultFetchOptions}=require("./constants");exports.fetchURL=function fetchURL(options){return new Promise((resolve,reject)=>{options=Object.assign({},defaultFetchOptions,options);$.ajax(options).then(resolve).fail(reject)})};exports.getClasses=function getClasses(from,what){if(!(what instanceof Array))return from[what];const res=[];for(const key of what){if(typeof from[key]==="undefined"){console.warn(from,`doesn't have property ${key}. Check module numbers`)}res.push(from[key])}return res.join(" ")}},{"./constants":6}],9:[function(require,module,exports){"use strict";const Server=require("./server.js");const Emoji=require("./emoji.js");const Picker=require("./picker.js");const{API_BASE:API_BASE,TOKEN_KEY:TOKEN_KEY,TRANSLATION_MODULE:TRANSLATION_MODULE,EMOJI_STORAGE_MODULE:EMOJI_STORAGE_MODULE,LOCAL_STORAGE_MODULE:LOCAL_STORAGE_MODULE,CUSTOM_EMOJI_STORAGE_MODULE:CUSTOM_EMOJI_STORAGE_MODULE,SERVERS_STORAGE_MODULE:SERVERS_STORAGE_MODULE,SERVERS_PERMISSIONS_MODULE:SERVERS_PERMISSIONS_MODULE,EMOJI_ROW_CATEGORY_HEIGHT:EMOJI_ROW_CATEGORY_HEIGHT}=require("./constants.js");function getServers(){return new Promise((resolve,reject)=>{if(!SERVERS_STORAGE_MODULE||!SERVERS_STORAGE_MODULE.getGuilds){reject(new Error("Server storage module is not pointing to server storage"))}function checkServers(){const servers=Object.values(SERVERS_STORAGE_MODULE.getGuilds());if(servers.length>0){resolve(servers)}setTimeout(checkServers,1e3)}checkServers()})}function parseServer({id:id,name:name}){return new Promise((resolve,reject)=>{if(!SERVERS_PERMISSIONS_MODULE||!SERVERS_PERMISSIONS_MODULE.getGuildPermissions){reject(new Error("Server permission module is not pointing to permission storage"))}if(!CUSTOM_EMOJI_STORAGE_MODULE||!CUSTOM_EMOJI_STORAGE_MODULE.getDisambiguatedEmojiContext){reject(new Error("Custom emoji storage module is not pointing to custom emoji storage"))}const server=new Server(id,name,SERVERS_PERMISSIONS_MODULE.getGuildPermissions(id));const emojiContext=CUSTOM_EMOJI_STORAGE_MODULE.getDisambiguatedEmojiContext(id);resolve(CUSTOM_EMOJI_STORAGE_MODULE.getGuildEmoji(`${id}`).map(e=>emojiContext.getById(e.id)).filter(e=>!!e).reduce(function(server,emoji){server.addEmoji(Emoji.fromRaw(emoji));return server},server))})}function parseServers(serversA){return Promise.all(serversA.map(parseServer))}function loadStandartEmojis(){const commonEmojisServers=[];const commonEmojis=[];const height={};const translation=TRANSLATION_MODULE.Messages;const categories=EMOJI_STORAGE_MODULE.getCategories();let $commonEmojisSpansCacheSpan=$("<span></span>");for(let category of categories){const tr=translation[`EMOJI_CATEGORY_${category.toUpperCase()}`];const fakeServer=new Server(tr,tr,262144);const emojis=EMOJI_STORAGE_MODULE.getByCategory(category);for(let emoji of emojis){const emoje=new Emoji(emoji.uniqueName,emoji.uniqueName,emoji.managed,emoji.allNamesString.includes(":"),[],emoji.defaultUrl);fakeServer.addEmoji(emoje);commonEmojis.push(emoje)}commonEmojisServers.push(fakeServer);height[category]=EMOJI_ROW_CATEGORY_HEIGHT*(1+Math.ceil(emojis.length/10));$commonEmojisSpansCacheSpan.append(Picker.buildServerSpan(fakeServer))}return Promise.resolve({categoriesHeight:height,emojis:commonEmojis,servers:commonEmojisServers,spanCache:$commonEmojisSpansCacheSpan.html()})}function doGetEmojis(){const token=LOCAL_STORAGE_MODULE.impl.get(TOKEN_KEY);$.ajaxSetup({crossDomain:true,headers:{authorization:token}});return getServers().then(parseServers).then(loadStandartEmojis).catch(e=>{console.error("Error initializing Better Emojis!\nProbably modules order has been changed\n",e)})}module.exports=doGetEmojis},{"./constants.js":6,"./emoji.js":7,"./picker.js":13,"./server.js":14}],10:[function(require,module,exports){(function(name,definition){if(typeof module!=="undefined")module.exports=definition();else if(typeof define==="function"&&typeof define.amd==="object")define(definition);else this[name]=definition()})("Clusterize",function(){"use strict";var ie=function(){for(var v=3,el=document.createElement("b"),all=el.all||[];el.innerHTML="\x3c!--[if gt IE "+ ++v+"]><i><![endif]--\x3e",all[0];){}return v>4?v:document.documentMode}(),is_mac=navigator.platform.toLowerCase().indexOf("mac")+1;var Clusterize=function(data){if(!(this instanceof Clusterize)){return new Clusterize(data)}var self=this;var defaults={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:true,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:true,callbacks:{}};self.options={};var options=["rows_in_block","blocks_in_cluster","show_no_data_row","no_data_class","no_data_text","keep_parity","tag","callbacks"];for(var i=0,option;option=options[i];i++){self.options[option]=typeof data[option]!=="undefined"&&data[option]!=null?data[option]:defaults[option]}var elems=["scroll","content"];for(var i=0,elem;elem=elems[i];i++){self[elem+"_elem"]=data[elem+"Id"]?document.getElementById(data[elem+"Id"]):data[elem+"Elem"];if(!self[elem+"_elem"]){throw new Error("Error! Could not find "+elem+" element")}}if(!self.content_elem.hasAttribute("tabindex")){self.content_elem.setAttribute("tabindex",0)}var rows=isArray(data.rows)?data.rows:self.fetchMarkup(),cache={},scroll_top=self.scroll_elem.scrollTop;self.insertToDOM(rows,cache);self.scroll_elem.scrollTop=scroll_top;var last_cluster=false,scroll_debounce=0,pointer_events_set=false,scrollEv=function(){if(is_mac){if(!pointer_events_set)self.content_elem.style.pointerEvents="none";pointer_events_set=true;clearTimeout(scroll_debounce);scroll_debounce=setTimeout(function(){self.content_elem.style.pointerEvents="auto";pointer_events_set=false},50)}if(last_cluster!=(last_cluster=self.getClusterNum())){self.insertToDOM(rows,cache)}if(self.options.callbacks.scrollingProgress){self.options.callbacks.scrollingProgress(self.getScrollProgress())}},resize_debounce=0,resizeEv=function(){clearTimeout(resize_debounce);resize_debounce=setTimeout(self.refresh,100)};on("scroll",self.scroll_elem,scrollEv);on("resize",window,resizeEv);self.destroy=function(clean){off("scroll",self.scroll_elem,scrollEv);off("resize",window,resizeEv);self.html((clean?self.generateEmptyRow():rows).join(""))};self.refresh=function(force){if(self.getRowsHeight(rows)||force)self.update(rows)};self.update=function(new_rows){rows=isArray(new_rows)?new_rows:[];var scroll_top=self.scroll_elem.scrollTop;if(rows.length*self.options.item_height<scroll_top){self.scroll_elem.scrollTop=0;last_cluster=0}self.insertToDOM(rows,cache);self.scroll_elem.scrollTop=scroll_top};self.clear=function(){self.update([])};self.getRowsAmount=function(){return rows.length};self.getScrollProgress=function(){return this.options.scroll_top/(rows.length*this.options.item_height)*100||0};var add=function(where,_new_rows){var new_rows=isArray(_new_rows)?_new_rows:[];if(!new_rows.length)return;rows=where=="append"?rows.concat(new_rows):new_rows.concat(rows);self.insertToDOM(rows,cache)};self.append=function(rows){add("append",rows)};self.prepend=function(rows){add("prepend",rows)}};Clusterize.prototype={constructor:Clusterize,fetchMarkup:function(){var rows=[],rows_nodes=this.getChildNodes(this.content_elem);while(rows_nodes.length){rows.push(rows_nodes.shift().outerHTML)}return rows},exploreEnvironment:function(rows,cache){var opts=this.options;opts.content_tag=this.content_elem.tagName.toLowerCase();if(!rows.length)return;if(ie&&ie<=9&&!opts.tag)opts.tag=rows[0].match(/<([^>\s/]*)/)[1].toLowerCase();if(this.content_elem.children.length<=1)cache.data=this.html(rows[0]+rows[0]+rows[0]);if(!opts.tag)opts.tag=this.content_elem.children[0].tagName.toLowerCase();this.getRowsHeight(rows)},getRowsHeight:function(rows){var opts=this.options,prev_item_height=opts.item_height;opts.cluster_height=0;if(!rows.length)return;var nodes=this.content_elem.children;var node=nodes[Math.floor(nodes.length/2)];opts.item_height=node.offsetHeight;if(opts.tag=="tr"&&getStyle("borderCollapse",this.content_elem)!="collapse"){opts.item_height+=parseInt(getStyle("borderSpacing",this.content_elem),10)||0}if(opts.tag!="tr"){var marginTop=parseInt(getStyle("marginTop",node),10)||0;var marginBottom=parseInt(getStyle("marginBottom",node),10)||0;opts.item_height+=Math.max(marginTop,marginBottom)}opts.block_height=opts.item_height*opts.rows_in_block;opts.rows_in_cluster=opts.blocks_in_cluster*opts.rows_in_block;opts.cluster_height=opts.blocks_in_cluster*opts.block_height;return prev_item_height!=opts.item_height},getClusterNum:function(){this.options.scroll_top=this.scroll_elem.scrollTop;return Math.floor(this.options.scroll_top/(this.options.cluster_height-this.options.block_height))||0},generateEmptyRow:function(){var opts=this.options;if(!opts.tag||!opts.show_no_data_row)return[];var empty_row=document.createElement(opts.tag),no_data_content=document.createTextNode(opts.no_data_text),td;empty_row.className=opts.no_data_class;if(opts.tag=="tr"){td=document.createElement("td");td.colSpan=100;td.appendChild(no_data_content)}empty_row.appendChild(td||no_data_content);return[empty_row.outerHTML]},generate:function(rows,cluster_num){var opts=this.options,rows_len=rows.length;if(rows_len<opts.rows_in_block){return{top_offset:0,bottom_offset:0,rows_above:0,rows:rows_len?rows:this.generateEmptyRow()}}var items_start=Math.max((opts.rows_in_cluster-opts.rows_in_block)*cluster_num,0),items_end=items_start+opts.rows_in_cluster,top_offset=Math.max(items_start*opts.item_height,0),bottom_offset=Math.max((rows_len-items_end)*opts.item_height,0),this_cluster_rows=[],rows_above=items_start;if(top_offset<1){rows_above++}for(var i=items_start;i<items_end;i++){rows[i]&&this_cluster_rows.push(rows[i])}return{top_offset:top_offset,bottom_offset:bottom_offset,rows_above:rows_above,rows:this_cluster_rows}},renderExtraTag:function(class_name,height){var tag=document.createElement(this.options.tag),clusterize_prefix="clusterize-";tag.className=[clusterize_prefix+"extra-row",clusterize_prefix+class_name].join(" ");height&&(tag.style.height=height+"px");return tag.outerHTML},insertToDOM:function(rows,cache){if(!this.options.cluster_height){this.exploreEnvironment(rows,cache)}var data=this.generate(rows,this.getClusterNum()),this_cluster_rows=data.rows.join(""),this_cluster_content_changed=this.checkChanges("data",this_cluster_rows,cache),top_offset_changed=this.checkChanges("top",data.top_offset,cache),only_bottom_offset_changed=this.checkChanges("bottom",data.bottom_offset,cache),callbacks=this.options.callbacks,layout=[];if(this_cluster_content_changed||top_offset_changed){if(data.top_offset){this.options.keep_parity&&layout.push(this.renderExtraTag("keep-parity"));layout.push(this.renderExtraTag("top-space",data.top_offset))}layout.push(this_cluster_rows);data.bottom_offset&&layout.push(this.renderExtraTag("bottom-space",data.bottom_offset));callbacks.clusterWillChange&&callbacks.clusterWillChange();this.html(layout.join(""));this.options.content_tag=="ol"&&this.content_elem.setAttribute("start",data.rows_above);callbacks.clusterChanged&&callbacks.clusterChanged()}else if(only_bottom_offset_changed){this.content_elem.lastChild.style.height=data.bottom_offset+"px"}},html:function(data){var content_elem=this.content_elem;if(ie&&ie<=9&&this.options.tag=="tr"){var div=document.createElement("div"),last;div.innerHTML="<table><tbody>"+data+"</tbody></table>";while(last=content_elem.lastChild){content_elem.removeChild(last)}var rows_nodes=this.getChildNodes(div.firstChild.firstChild);while(rows_nodes.length){content_elem.appendChild(rows_nodes.shift())}}else{content_elem.innerHTML=data}},getChildNodes:function(tag){var child_nodes=tag.children,nodes=[];for(var i=0,ii=child_nodes.length;i<ii;i++){nodes.push(child_nodes[i])}return nodes},checkChanges:function(type,value,cache){var changed=value!=cache[type];cache[type]=value;return changed}};function on(evt,element,fnc){return element.addEventListener?element.addEventListener(evt,fnc,false):element.attachEvent("on"+evt,fnc)}function off(evt,element,fnc){return element.removeEventListener?element.removeEventListener(evt,fnc,false):element.detachEvent("on"+evt,fnc)}function isArray(arr){return Object.prototype.toString.call(arr)==="[object Array]"}function getStyle(prop,elem){return window.getComputedStyle?window.getComputedStyle(elem)[prop]:elem.currentStyle[prop]}return Clusterize})},{}],11:[function(require,module,exports){"use strict";const Picker=require("./picker.js");const SettingsPanel=require("./settings-panel.js");const Settings=require("./settings.js");const Observer=require("./observer.js").ChildAddRemoveObserver;const{EMOJI_PICKER_PATH:EMOJI_PICKER_PATH,EMOJI_BUTTON_CLASS:EMOJI_BUTTON_CLASS}=require("./constants.js");const initEmojis=require("./initializer.js");function attachPickerObserver(){if(window.better_emojis.pickerObserver){window.better_emojis.pickerObserver.disconnect()}else{window.better_emojis.pickerObserver=new Observer(null,()=>{if(!Settings.get("enabled")){return}let isPickerOpened=!!$(EMOJI_PICKER_PATH).find(".emoji-picker").length;let isInlineOrTextareaPicker=$(`.${EMOJI_BUTTON_CLASS}`).hasClass("popout-open")||!!$(".btn-reaction.popout-open").length;if(isPickerOpened&&isInlineOrTextareaPicker){Picker.show()}},()=>{if(window.better_emojis.current_cluster){window.better_emojis.current_cluster.destroy()}})}window.better_emojis.pickerObserver.reattach=attachPickerObserver;window.better_emojis.pickerObserver.observe($(EMOJI_PICKER_PATH)[0])}function attachSettingsObserver(){if(window.better_emojis.settingsObserver){window.better_emojis.settingsObserver.disconnect()}else{window.better_emojis.settingsObserver=new Observer(null,mutation=>{setTimeout(()=>{SettingsPanel.inject(mutation.addedNodes[0])},30)})}window.better_emojis.settingsObserver.reattach=attachPickerObserver;window.better_emojis.settingsObserver.observe($(".layers")[0])}initEmojis().then(emojiCache=>{Picker.setCommonEmojiSpanCache(emojiCache);setTimeout(()=>{attachPickerObserver();attachSettingsObserver();SettingsPanel.updateHiddenServers();console.log("Better Emojis initialized")},2e3)})},{"./constants.js":6,"./initializer.js":9,"./observer.js":12,"./picker.js":13,"./settings-panel.js":16,"./settings.js":17}],12:[function(require,module,exports){"use strict";const observer=Symbol("observer");const addListeners=Symbol("addListeners");const removeListeners=Symbol("removeListeners");class ChildAddRemoveObserver{constructor(target=null,addListener=null,removeListener=null){this[observer]=new MutationObserver(([mutation])=>{if(mutation.type!=="childList"){return}if(mutation.addedNodes.length>0){for(const listener of this[addListeners]){listener(mutation)}}if(mutation.removedNodes.length>0){for(const listener of this[removeListeners]){listener(mutation)}}});this[addListeners]=[];this[removeListeners]=[];if(target){this.observe(target)}this.add(addListener).remove(removeListener)}observe(target){if(!target||!(target instanceof Node)){throw new TypeError("Target must be Node!")}this[observer].observe(target,{childList:true});return this}add(listener){return this.on("add",listener)}remove(listener){return this.on("remove",listener)}on(evt,listener){if(!listener){return}if(typeof listener!=="function"){throw new TypeError("Listener must be function")}switch(evt){case"add":this[addListeners].push(listener);break;case"remove":this[removeListeners].push(listener);break}return this}off(evt){switch(evt){case"add":this[addListeners]=[];break;case"remove":this[removeListeners]=[];break}return this}disconnect(){this[observer].disconnect();return this}}module.exports.ChildAddRemoveObserver=ChildAddRemoveObserver},{}],13:[function(require,module,exports){"use strict";const Clusterize=require("./lib/clusterize.js");const Emoji=require("./emoji.js");const Server=require("./server.js");const Settings=require("./settings.js");const{fetchURL:fetchURL}=require("./helpers");const{API_BASE:API_BASE,IS_NUMBER_REGEX:IS_NUMBER_REGEX,EMOJI_PICKER_PATH:EMOJI_PICKER_PATH,ELEMENT_SCROLLER_WRAP:ELEMENT_SCROLLER_WRAP,REACTION_POPOUT_REGEX:REACTION_POPOUT_REGEX,ELEMENT_SERVER_EMOJI_LIST:ELEMENT_SERVER_EMOJI_LIST,ELEMENT_SERVER_EMOJI_LIST_ROW:ELEMENT_SERVER_EMOJI_LIST_ROW,CURRENT_SELECTED_CHANNEL_REGEX:CURRENT_SELECTED_CHANNEL_REGEX,ELEMENT_SERVER_EMOJI_LIST_ROW_ENTRY:ELEMENT_SERVER_EMOJI_LIST_ROW_ENTRY,EMOJI_BUTTON_CLASS:EMOJI_BUTTON_CLASS,CHANNEL_TEXTAREA_CLASS:CHANNEL_TEXTAREA_CLASS,CUSTOM_EMOJI_STORAGE_MODULE:CUSTOM_EMOJI_STORAGE_MODULE,TRANSLATION_MODULE:TRANSLATION_MODULE,STANDART_EMOJI_CLASS:STANDART_EMOJI_CLASS,EMOJI_ROW_CATEGORY_HEIGHT:EMOJI_ROW_CATEGORY_HEIGHT,EMOJI_STORAGE_MODULE:EMOJI_STORAGE_MODULE}=require("./constants.js");let commonEmojisSpansCache="";let categoriesHeight={};let SCROLLER_WRAP=null;let SCROLLER_WRAP_OLD=null;let SEARCH_INPUT=null;function buildScrollerWrap(){const $wrap=SCROLLER_WRAP||$(ELEMENT_SCROLLER_WRAP);const $scr=$wrap.find(".scroller");const currentServer=Server.getCurrentServer();const serverContext=CUSTOM_EMOJI_STORAGE_MODULE.getDisambiguatedEmojiContext(currentServer.id);let customEmojisHeight=0;$scr.html(" ").off("click").off("mouseenter").off("mouseleave");if(Settings.get("picker.frequently-used.enabled",true)){const freqUsed=serverContext.getFrequentlyUsedEmojis().map(e=>e instanceof STANDART_EMOJI_CLASS?Emoji.getById(e.uniqueName):Emoji.getById(e.id));if(freqUsed.length>0){const span=buildServerSpan({name:TRANSLATION_MODULE.Messages.EMOJI_CATEGORY_RECENT},freqUsed);customEmojisHeight+=EMOJI_ROW_CATEGORY_HEIGHT*(1+Math.ceil(freqUsed.length/10));$scr.append(span)}}if(currentServer.emojis.length>0){const emojis=currentServer.availableEmojis();customEmojisHeight+=EMOJI_ROW_CATEGORY_HEIGHT*(1+Math.ceil(emojis.length/10));$scr.append(buildServerSpan(currentServer,emojis))}if(currentServer.canUseExternalEmojis){for(const server of Server.getAllServers()){let availableEmojis=server.availableEmojis();if(!server.isCurrent()&&server.isShownInPicker()&&IS_NUMBER_REGEX.test(server.id)&&availableEmojis.length>0){customEmojisHeight+=EMOJI_ROW_CATEGORY_HEIGHT*(1+Math.ceil(availableEmojis.length/10));$scr.append(buildServerSpan(server,availableEmojis))}}}categoriesHeight.custom=customEmojisHeight;replaceCategories();if(commonEmojisSpansCache){$scr.append(commonEmojisSpansCache)}window.better_emojis.current_cluster=new Clusterize({rows_in_block:10,blocks_in_cluster:3,scrollElem:$scr[0],contentElem:$scr[0]});const emojiClickHandler=$(`.${EMOJI_BUTTON_CLASS}`).hasClass("popout-open")?putEmojiInTextarea:addCurrentMessageReaction;$scr.on("click",".emoji-item",e=>{console.log("Selected emoji - ",Emoji.getById($(e.target).attr("data-emoji")))}).on("click",".emoji-item",e=>{const emoji=Emoji.getById($(e.target).attr("data-emoji"));if(emoji.isCustom()){emojiClickHandler(serverContext.getById($(e.target).attr("data-emoji")))}else{emojiClickHandler(emoji)}}).on("mouseenter",".emoji-item",e=>{$(e.target).addClass("selected");if(SEARCH_INPUT){SEARCH_INPUT.attr("placeholder",Emoji.getById($(e.target).attr("data-emoji")).useName)}}).on("mouseleave",".emoji-item",e=>{$(e.target).removeClass("selected");if(SEARCH_INPUT){SEARCH_INPUT.attr("placeholder","Find the perfect emoji")}});return $wrap}function buildServerSpan(server,availableEmojis){const $emojiList=$(ELEMENT_SERVER_EMOJI_LIST);const emojis=availableEmojis||server.availableEmojis();$emojiList.find(".category").html(server.name);$emojiList.append(buildEmojisRows(emojis));return $emojiList.html()}function buildEmojisRows(eL){const $emojiList=$('<span class="tl-emoji-list"></span>');let $emojiListRow=$(ELEMENT_SERVER_EMOJI_LIST_ROW);const emojiElement=function(emoji){return $(ELEMENT_SERVER_EMOJI_LIST_ROW_ENTRY).css("background-image",`url("${emoji.url}")`).attr("data-emoji",`${emoji.id}`)};for(let i=0;i<eL.length;i++){if(i!==0&&i%10===0){$emojiList.append($emojiListRow);$emojiListRow=$(ELEMENT_SERVER_EMOJI_LIST_ROW)}$emojiListRow.append(emojiElement(eL[i]))}$emojiList.append($emojiListRow);return $emojiList.html()}function putEmojiInTextarea(emoji){const $textarea=$(`.${CHANNEL_TEXTAREA_CLASS} >> textarea`);$textarea.val($textarea.val()+(emoji.require_colons?`:${emoji.name}:`:emoji.name))}function findReact(dom){for(const key in dom){if(key.startsWith("__reactInternalInstance$")){return dom[key]}}return null}function getSelectedMessageId(){try{return REACTION_POPOUT_REGEX.exec(findReact($(".btn-reaction.popout-open").closest(".message").find(".message-text").get(0))._currentElement.props.children.filter(c=>Object.keys(c.props).includes("subscribeTo"))[0].props.subscribeTo)[1]}catch(e){return null}}function getCurrentSelectedChannel(){return CURRENT_SELECTED_CHANNEL_REGEX.exec(window.location.pathname)[1]}function addCurrentMessageReaction(emoji){return addMessageReaction(getCurrentSelectedChannel(),getSelectedMessageId(),emoji)}function addMessageReaction(channel,message,emoji){return fetchURL({url:`${API_BASE}/channels/${channel}/messages/${message}/reactions/:${emoji.name}:${emoji.id}/@me`,method:"PUT",dataType:"json"})}function showScroller(isDefault){const $wrap=$(EMOJI_PICKER_PATH).find(".scroller-wrap, .no-search-results");if(isDefault){$wrap.filter(".tl-emoji-scroller-wrap").hide();$wrap.not(".tl-emoji-scroller-wrap").show()}else{$wrap.filter(".tl-emoji-scroller-wrap").show();$wrap.not(".tl-emoji-scroller-wrap").hide()}}function showOriginalScroller(){showScroller(true)}function showCustomScroller(){showScroller(false)}function replaceScroller(){SCROLLER_WRAP=buildScrollerWrap();SCROLLER_WRAP_OLD=$(EMOJI_PICKER_PATH).find(".scroller-wrap");SCROLLER_WRAP_OLD.hide().before(SCROLLER_WRAP)}function replaceSearchInput(){let $picker=$(EMOJI_PICKER_PATH);SEARCH_INPUT=$picker.find("input");SEARCH_INPUT.on("change keydown keyup paste",()=>{showScroller(!!SEARCH_INPUT.val())})}function replaceCategories(){const $picker=$(EMOJI_PICKER_PATH);const $oldCategories=$picker.find(".categories").hide();const $input=$picker.find("input");const $categoriesElement=$(`\n\t\t<div class="categories be-emoji-categories"></div>\n\t`);const categories=EMOJI_STORAGE_MODULE.getCategories();categories.unshift("custom");const scrollsTop={};let fromTop=0;function categoryItem(category){return $(`<div class="item ${category}"></div>`).click(function(){const $this=$(this);$categoriesElement.children().removeClass("selected");$this.addClass("selected");showCustomScroller();$input.val("");SCROLLER_WRAP.find(".scroller").stop().animate({scrollTop:scrollsTop[category]},300,"swing")})}for(const category of categories){scrollsTop[category]=fromTop;fromTop+=categoriesHeight[category];$categoriesElement.append(categoryItem(category))}$categoriesElement.find(".custom").addClass("selected");$categoriesElement.append($('<div class="item"></div>'));$oldCategories.before($categoriesElement)}function addCustomScrollerParts(){setTimeout(()=>{setTimeout(showCustomScroller,10);replaceScroller();replaceSearchInput()},20)}module.exports.buildServerSpan=buildServerSpan;module.exports.show=addCustomScrollerParts;module.exports.setCommonEmojiSpanCache=function(cache,categoriesHeightArg){commonEmojisSpansCache=cache;categoriesHeight=categoriesHeightArg}},{"./constants.js":6,"./emoji.js":7,"./helpers":8,"./lib/clusterize.js":10,"./server.js":14,"./settings.js":17}],14:[function(require,module,exports){"use strict";const Emoji=require("./emoji.js");const Settings=require("./settings.js");const GLOBAL_SERVER_LIST=[];const id=Symbol("id");const name=Symbol("name");const emojis=Symbol("emojis");const sharedEmojis=Symbol("sharedEmojis");const permissions=Symbol("permissions");const serverRegex=Symbol("serverRegex");class Server{constructor(_id,_name,_permissions,_emojis=[],_sharedEmojis=[]){if(GLOBAL_SERVER_LIST.some(s=>s.id===_id)){throw new Error("Cannot have multiple servers with same id!")}this[id]=_id;this[name]=_name;this[permissions]=_permissions;this[emojis]=_emojis;this[sharedEmojis]=_sharedEmojis;this[serverRegex]=new RegExp(`.*/${_id.toString()}/\\d+`);GLOBAL_SERVER_LIST.push(this)}addEmoji(emoji){if(!(emoji instanceof Emoji)){throw new TypeError("Only objects of class Emoji can be added using this method")}if(this[emojis].some(e=>e.id===emoji.id)){return}this[emojis].push(emoji);if(emoji.isManaged){this[sharedEmojis].push(emoji)}return this}get canUseExternalEmojis(){return this[permissions]&262144}get id(){return this[id]}get name(){return this[name]}get permissions(){return this[permissions]}get emojis(){return this[emojis]}get sharedEmojis(){return this[sharedEmojis]}isGuild(){return/\d+/.test(this[id])}isCurrent(){return this[serverRegex].test(window.location)}availableEmojis(){const emojiList=this.isCurrent()?this.emojis:this.sharedEmojis;return emojiList.filter(e=>Settings.get(`picker.emoji.enabled.${e.id}`,true))}possibleEmojis(){const list=this.emojis;for(const server of GLOBAL_SERVER_LIST){if(server.id===this.id){continue}list.push(...server.sharedEmojis)}return list}isShownInList(){return Settings.get(`serverlist.show.${this[id]}`,true)}isShownInPicker(){return Settings.get(`picker.server.show.${this[id]}`,true)}static getCurrentServer(){return GLOBAL_SERVER_LIST.reduce((p,c)=>p||c.isCurrent()&&c,false)||null}static getAllServersUnordered(){return GLOBAL_SERVER_LIST}static getAllServers(){if(Settings.get("picker.serversorder",false)){const order=Settings.get("picker.serversorder");return GLOBAL_SERVER_LIST.sort((a,b)=>order.indexOf(a.id)-order.indexOf(b.id))}else{const servers=[];servers.push(...GLOBAL_SERVER_LIST);Settings.set("picker.serversorder",servers.map(c=>c.id));return servers}}static getById(id){return GLOBAL_SERVER_LIST.reduce((p,c)=>p||c.id==id&&c,false)||null}}new Server("@me","@me",262144);module.exports=Server},{"./emoji.js":7,"./settings.js":17}],15:[function(require,module,exports){"use strict";const{getClasses:getClasses}=require("./helpers.js");const{SWITCH_CLASSES:SWITCH_CLASSES,FLEX_CHILD_CLASSES:FLEX_CHILD_CLASSES,FLEX_CLASSES:FLEX_CLASSES,HEADER_CLASSES:HEADER_CLASSES,SWITCH_ITEM_CLASSES:SWITCH_ITEM_CLASSES,DIVIDER_ITEM_CLASSES:DIVIDER_ITEM_CLASSES,CARD_CLASSES:CARD_CLASSES,SERVER_CARD_CLASSES:SERVER_CARD_CLASSES}=require("./classes.js");const Settings=require("./settings.js");function serverCard(server,iconStorage,onServerChangeState){const $card=$(`\n\t\t<div class="be-accordion-item ${CARD_CLASSES.cardPrimary} ${SERVER_CARD_CLASSES.serverCard}" id="server-card-${server.id}" style="padding: 7px">\n\t\t\t<div class="be-accordion-title ${getClasses(FLEX_CLASSES,["horizontal","flex","justifyStart","alignStretch","noWrap"])}">\n\t\t\t\t<div class="${FLEX_CHILD_CLASSES.flexChild}" style="padding-right: 15px;">\n\t\t\t\t\t<img class="${SERVER_CARD_CLASSES.icon}" src="${iconStorage[server.id]}"/>\n\t\t\t\t</div>\n\t\t\t\t<div class="${FLEX_CHILD_CLASSES.flexChild} ${FLEX_CLASSES.vertical}" style="width: 60%">\n\t\t\t\t\t<h5 class="${FLEX_CHILD_CLASSES.flexChild} ${HEADER_CLASSES.h5} margin-bottom-4">${server.name}</h5>\n\t\t\t\t\t<h5 class="${FLEX_CHILD_CLASSES.flexChild} ${HEADER_CLASSES.h5} margin-bottom-4">Emojis: ${server.emojis.length}, BBTV: ${server.sharedEmojis.length}</h5>\t\n\t\t\t\t</div>\n\t\t\t\t<div class="${FLEX_CHILD_CLASSES.flexChild} ${FLEX_CLASSES.vertical}" style="flex: 1 1 auto;">\n\t\t\t\t\t<div class="margin-bottom-4 ${[SERVER_CARD_CLASSES.showInPicker,getClasses(FLEX_CHILD_CLASSES,["flex","horizontal"]),getClasses(FLEX_CLASSES,["justifyStart","alignStart","noWrap"])].join(" ")}" style="flex: 1 1 auto;">\n\t\t\t\t\t\t<h3 class="${[getClasses(HEADER_CLASSES,["h3","defaultColor"]),SWITCH_ITEM_CLASSES.title,FLEX_CHILD_CLASSES.flexChild].join(" ")}" style="flex: 1 1 auto;">\n\t\t\t\t\t\t\tPicker\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<div class="${SWITCH_CLASSES.switchWrapperDefaultActive} ${FLEX_CHILD_CLASSES.flexChild}" style="flex: 0 0 auto;">\n\t\t\t\t\t\t\t<input type="checkbox" class="${SWITCH_CLASSES.checkbox}" value="on">\n\t\t\t\t\t\t\t<div class="${SWITCH_CLASSES.switch} ${server.isShownInPicker()?SWITCH_CLASSES.checked:""} ${SERVER_CARD_CLASSES.showInPickerSwitch}"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="margin-bottom-4 ${[SERVER_CARD_CLASSES.showInServerList,getClasses(FLEX_CHILD_CLASSES,["flex","horizontal"]),getClasses(FLEX_CLASSES,["justifyStart","alignStart","noWrap"])].join(" ")}" style="flex: 1 1 auto;">\n\t\t\t\t\t\t<h3 class="${[getClasses(HEADER_CLASSES,["h3","defaultColor"]),SWITCH_ITEM_CLASSES.title,FLEX_CHILD_CLASSES.flexChild].join(" ")}" style="flex: 1 1 auto;">\n\t\t\t\t\t\t\tServer list\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<div class="${SWITCH_CLASSES.switchWrapperDefaultActive} ${FLEX_CHILD_CLASSES.flexChild}" style="flex: 0 0 auto;">\n\t\t\t\t\t\t\t<input type="checkbox" class="${SWITCH_CLASSES.checkbox}" value="on">\n\t\t\t\t\t\t\t<div class="${SWITCH_CLASSES.switch} ${server.isShownInList()?SWITCH_CLASSES.checked:""} ${SERVER_CARD_CLASSES.showInServerListSwitch}"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="be-accordion-data">\n\t\t\t\t<div class="${DIVIDER_ITEM_CLASSES.divider}" style="margin-top: 4px; margin-bottom: 7px;"></div>\n\t\t\t\t<div class="container">\n\t\t\t\t\t<div class="be-emoji-container-wrapper">\n\t\t\t\t\t\t<h3 class="container-title ${getClasses(HEADER_CLASSES,["h3","defaultColor"])}">\n\t\t\t\t\t\t\tEnabled Emojis\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<div class="${CARD_CLASSES.cardPrimary} be-emoji-container enabled-emoji-container"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="be-emoji-container-wrapper" style="padding-left:5px">\n\t\t\t\t\t\t<h3 class="container-title ${getClasses(HEADER_CLASSES,["h3","defaultColor"])}">\n\t\t\t\t\t\t\tDisabled Emojis\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<div class="${CARD_CLASSES.cardPrimary} be-emoji-container disabled-emoji-container"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`);const $enabledEmojis=$card.find(".enabled-emoji-container");const $disabledEmojis=$card.find(".disabled-emoji-container");const $accordionContent=$card.find(".be-accordion-data");const $showModeButton=$("#be-emoji-show-mode");function emojiItem(emoji){return $(`<div class="be-emoji-item \n\t\t\t\t${emoji.isManaged?"be-emoji-item-bbtv":$showModeButton.hasClass("be-button-enabled")?"be-emoji-item-deafult be-emoji-faded":"be-emoji-item-deafult"}"></div>`).css("background-image",`url("${emoji.url}")`).data("emoji-id",`${emoji.id}`).attr("title",`${emoji.useName}`).dblclick(function(){const $this=$(this).detach();if(Settings.get(`picker.emoji.enabled.${emoji.id}`,true)){$disabledEmojis.append($this)}else{$enabledEmojis.append($this)}handleChange()})}function handleChange(){$enabledEmojis.children().map((i,c)=>Settings.set(`picker.emoji.enabled.${$(c).data("emoji-id")}`,true));$disabledEmojis.children().map((i,c)=>Settings.set(`picker.emoji.enabled.${$(c).data("emoji-id")}`,false))}let enabledEmojisSortable;let disabledEmojisSortable;let emojiTooltip;$enabledEmojis.on("change",handleChange);$disabledEmojis.on("change",handleChange);$card.data("server-id",server.id);$card.on("accordion.close",()=>{handleChange();$enabledEmojis.html("");$disabledEmojis.html("");enabledEmojisSortable.$destroy();disabledEmojisSortable.$destroy();emojiTooltip.$destroy()});$card.on("accordion.open",()=>{for(const emoji of server.emojis){if(Settings.get(`picker.emoji.enabled.${emoji.id}`,true)){$enabledEmojis.append(emojiItem(emoji))}else{$disabledEmojis.append(emojiItem(emoji))}}enabledEmojisSortable=UIkit.sortable($enabledEmojis,{group:`emoji-sortable-${server.id}`,animation:150,"cls-base":"be-emoji-container","cls-item":"be-emoji-item","cls-empty":"be-empty-sortable"});disabledEmojisSortable=UIkit.sortable($disabledEmojis,{group:`emoji-sortable-${server.id}`,animation:150,"cls-base":"be-emoji-container","cls-item":"be-emoji-item","cls-empty":"be-empty-sortable"});emojiTooltip=UIkit.tooltip($accordionContent.find(".be-emoji-item"))});$card.find(`.${SERVER_CARD_CLASSES.showInServerList}`).click(function(e){e.stopPropagation();const $switch=$(this).find(`.${SERVER_CARD_CLASSES.showInServerListSwitch}`);$switch.toggleClass(SWITCH_CLASSES.checked);const isShown=$switch.hasClass(SWITCH_CLASSES.checked);Settings.set(`serverlist.show.${server.id}`,isShown);onServerChangeState&&onServerChangeState(server,isShown)});$card.find(`.${SERVER_CARD_CLASSES.showInPicker}`).click(function(e){e.stopPropagation();const $switch=$(this).find(`.${SERVER_CARD_CLASSES.showInPickerSwitch}`);$switch.toggleClass(SWITCH_CLASSES.checked);Settings.set(`picker.server.show.${server.id}`,$switch.hasClass(SWITCH_CLASSES.checked))});return $card}module.exports=serverCard},{"./classes.js":5,"./helpers.js":8,"./settings.js":17}],16:[function(require,module,exports){"use strict";const{getClasses:getClasses}=require("./helpers.js");const{SETTINGS_CLASSES:SETTINGS_CLASSES,SIDEBAR_BUTTON_CLASS:SIDEBAR_BUTTON_CLASS,HEADER_CLASSES:HEADER_CLASSES,SERVER_CARD_CLASSES:SERVER_CARD_CLASSES}=require("./classes.js");const{TRANSLATION_MODULE:TRANSLATION_MODULE}=require("./constants.js");const Settings=require("./settings.js");const Server=require("./server.js");const serverCard=require("./serverCard.js");const checkbox=require("./checkbox.js");function buildSidebarEntry(){const $entry=$("<span/>");const $button=$("<div/>").addClass(SETTINGS_CLASSES.itemDefault).addClass(SIDEBAR_BUTTON_CLASS).html("Better Emojis");$button.mousedown(function(){const $this=$(this);changeClasses(SETTINGS_CLASSES.itemBrandSelected,SETTINGS_CLASSES.itemBrand);changeClasses(SETTINGS_CLASSES.itemDefaultSelected,SETTINGS_CLASSES.itemDefault);changeClasses(SETTINGS_CLASSES.itemDangerSelected,SETTINGS_CLASSES.itemDanger);$this.removeClass(SETTINGS_CLASSES.itemDefault).addClass(SETTINGS_CLASSES.itemDefaultSelected)});$entry.append($button).append($("<div/>").addClass(SETTINGS_CLASSES.separator));return{$entry:$entry,$button:$button}}function changeClasses(from,to,parent=null){const classes=`.${from.split(" ").join(".")}`;return(parent==null?$(classes):$(parent).find(classes)).removeClass(from).addClass(to)}function buildServerCards(){const guildsIcons=getServersIcons();const $serverSortable=$('<div class="be-server-sortable"></div>');const servers=Server.getAllServers();for(const server of servers){if(server.isGuild())$serverSortable.append(serverCard(server,guildsIcons,updateHiddenServers))}const serversAccordion=UIkit.accordion($serverSortable,{duration:150,targets:"> .be-accordion-item",toggle:"> .be-accordion-title",content:"> .be-accordion-data"});UIkit.sortable($serverSortable,{animation:150,"cls-item":SERVER_CARD_CLASSES.serverCard});$serverSortable.on("start",function(event,sortable,target,dragged){if(target.hasClass("uk-open")){serversAccordion.toggle(target,false);dragged.css({height:target.outerHeight()})}});$serverSortable.on("beforeshow",function(event,accordion){$(event.target).closest(".be-accordion-item").trigger("accordion.open")});$serverSortable.on("hidden",function(event,accordion){$(event.target).closest(".be-accordion-item").trigger("accordion.close")});$serverSortable.on("change",function(event,sortable,target){if(!sortable){return}const $children=sortable.$el.children();const out=[];out.length=$children.length;for(let i=0;i<$children.length;i++){out[i]=$($children[i]).data("server-id")}Settings.set("picker.serversorder",out)});return $serverSortable}function buildContentColumn(){const $column=$(`\n\t<div class="content-column default"><div>\n\t\t<div class="better-emojis-settings">\n\t\t\t<h2 class="${getClasses(HEADER_CLASSES,["h2","defaultColor","defaultMarginh2"])}">\n\t\t\t\t\tBetter Emojis\n\t\t\t\t</h2>\n\t\t\t\t<div class="flex-vertical">\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t</div>\n\t</div></div>\n\t`);const $contentDiv=$column.find(".flex-vertical");$contentDiv.append(checkbox({setting:"enabled",name:"Enabled",description:"Enable or disable this plugin",value:Settings.get("enabled"),change:value=>{Settings.set("enabled",value);updateHiddenServers()}}));$contentDiv.append(buildServerCards());return $column}const SERVER_REGEX=/\/channels\/(\d+)\/\d+/;const BACKGOUND_URL_REGEX=/background-image: url\("(.*)"\);/;function getServersIcons(){const guildsIcons={};$(".guild").map((i,guild)=>{const $avatar=$(guild).find(".avatar-small");const match=SERVER_REGEX.exec($avatar.attr("href"));if(!match){return guild}guildsIcons[`${match[1]}`]=BACKGOUND_URL_REGEX.exec($avatar.attr("style"))[1];return guild});return guildsIcons}function buildToggleDefaultEmojiButton(){const $button=$(`\n\t\t<div id="be-emoji-show-mode" class="btn-close esc-text be-emoji-toggle">\n\t\t\t<span class="text">ALL</span>\n\t\t\t<div class="esc-text be-emoji-toggle-title">Show emojis</div>\n\t\t</div>\n\t`);const $text=$button.find(".text");$button.click(function(){const $this=$(this);$(".be-emoji-container .be-emoji-item.be-emoji-item-deafult").toggleClass("be-emoji-faded");$this.toggleClass("be-button-enabled");if($this.hasClass("be-button-enabled")){$text.html("BBTV")}else{$text.html("ALL")}});return $button}function injectPanel(layer){const $layer=$(layer);const $fadeToggleButton=buildToggleDefaultEmojiButton();$layer.find(".tools").append($fadeToggleButton);const{$entry:$entry,$button:$button}=buildSidebarEntry();const $contentColumn=buildContentColumn().hide();const $contentRegion=$layer.find(".content-region-scroller");$contentRegion.prepend($contentColumn);$layer.find(".sidebar > div").children().mousedown(()=>{$contentRegion.find(".content-column").show();$contentColumn.hide();$button.removeClass(SETTINGS_CLASSES.itemDefaultSelected).addClass(SETTINGS_CLASSES.itemDefault)}).filter((index,element)=>$(element).text()===TRANSLATION_MODULE.Messages.CHANGE_LOG).before($entry);$button.mousedown(()=>{$contentRegion.find(".content-column").hide();$contentColumn.show()})}function updateHiddenServers(){$(".guild").map((i,guild)=>{const $avatar=$(guild).find(".avatar-small");const match=SERVER_REGEX.exec($avatar.attr("href"));if(!match){return guild}const server=Server.getById(match[1]);if(!server){console.log(match);return guild}if(server.isShownInList()||!Settings.get("enabled",true)){$(guild).removeAttr("style")}else{$(guild).animate({width:0,height:0},500,"swing",function(){$(this).hide()})}return guild})}exports.updateHiddenServers=updateHiddenServers;exports.inject=injectPanel},{"./checkbox.js":4,"./classes.js":5,"./constants.js":6,"./helpers.js":8,"./server.js":14,"./serverCard.js":15,"./settings.js":17}],17:[function(require,module,exports){"use strict";const{LOCAL_STORAGE_MODULE:LOCAL_STORAGE_MODULE,BETTER_EMOJIS_KEY:BETTER_EMOJIS_KEY}=require("./constants.js");const fs=require("fs");const path=require("path");const defaultSettings={enabled:true};const SETTINGS_HANDLER={get:function(target,name){if(typeof name!=="string"){return undefined}const path=name.split(".");if(!path.every(e=>!!e)){throw Error(`Invalid settings path: ${name}`)}let obj=target;for(const prop of path){obj=obj[prop];if(!obj){return obj}}return obj},set:function(target,name,value){if(typeof name!=="string"||!name){return value}const path=name.split(".");if(!path.every(e=>!!e)){throw Error(`Invalid settings path: ${name}`)}const lastKey=path.pop();let obj=target;for(const prop of path){if(!obj[prop]){obj[prop]={}}obj=obj[prop]}obj[lastKey]=value;return true}};const fileLocation=typeof window.betterEmojiLocation!=="undefined"&&fs.readFileSync&&fs.writeFileSync&&path.resolve?path.resolve(window.betterEmojiLocation,"config.json"):null;const settings=new Proxy(Object.assign(defaultSettings,loadSettings()),SETTINGS_HANDLER);function loadSettings(){try{return JSON.parse(fs.readFileSync(path.resolve(fileLocation,"config.json"),"utf-8"))}catch(err){console.log("Error loading settings from file:",err);return JSON.parse(LOCAL_STORAGE_MODULE.impl.get(BETTER_EMOJIS_KEY))}}function saveSettings(){if(fileLocation){fs.writeFileSync(path.resolve(fileLocation,"config.json"),JSON.stringify(settings,null,"\t"))}else{LOCAL_STORAGE_MODULE.impl.set(BETTER_EMOJIS_KEY,JSON.stringify(settings))}}exports.set=function(key,value){settings[key]=value;saveSettings()};function valueOrDefault(value,def){if(value===null||typeof value==="undefined"){return def}return value}window.beSettings=exports;exports.get=function(key,def){return valueOrDefault(settings[key],def)}},{"./constants.js":6,fs:1,path:2}]},{},[11]);