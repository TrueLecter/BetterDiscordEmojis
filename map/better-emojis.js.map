{
  "version": 3,
  "sources": [
    "node_modules/browser-pack/_prelude.js",
    "node_modules/browserify/lib/_empty.js",
    "node_modules/path-browserify/index.js",
    "node_modules/process/browser.js",
    "src/checkbox.js",
    "src/classes.js",
    "src/constants.js",
    "src/emoji.js",
    "src/helpers.js",
    "src/initializer.js",
    "src/lib/clusterize.js",
    "src/main.js",
    "src/observer.js",
    "src/picker.js",
    "src/server.js",
    "src/serverCard.js",
    "src/settings-panel.js",
    "src/settings.js"
  ],
  "names": [],
  "mappings": "AAAA;ACAA;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AChOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "generated.js",
  "sourceRoot": "",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "",
    "// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// resolves . and .. elements in a path array with directory names there\n// must be no slashes, empty elements, or device names (c:\\) in the array\n// (so also no leading and trailing slashes - it does not distinguish\n// relative and absolute paths)\nfunction normalizeArray(parts, allowAboveRoot) {\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = parts.length - 1; i >= 0; i--) {\n    var last = parts[i];\n    if (last === '.') {\n      parts.splice(i, 1);\n    } else if (last === '..') {\n      parts.splice(i, 1);\n      up++;\n    } else if (up) {\n      parts.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (allowAboveRoot) {\n    for (; up--; up) {\n      parts.unshift('..');\n    }\n  }\n\n  return parts;\n}\n\n// Split a filename into [root, dir, basename, ext], unix version\n// 'root' is just a slash, or nothing.\nvar splitPathRe =\n    /^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/;\nvar splitPath = function(filename) {\n  return splitPathRe.exec(filename).slice(1);\n};\n\n// path.resolve([from ...], to)\n// posix version\nexports.resolve = function() {\n  var resolvedPath = '',\n      resolvedAbsolute = false;\n\n  for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n    var path = (i >= 0) ? arguments[i] : process.cwd();\n\n    // Skip empty and invalid entries\n    if (typeof path !== 'string') {\n      throw new TypeError('Arguments to path.resolve must be strings');\n    } else if (!path) {\n      continue;\n    }\n\n    resolvedPath = path + '/' + resolvedPath;\n    resolvedAbsolute = path.charAt(0) === '/';\n  }\n\n  // At this point the path should be resolved to a full absolute path, but\n  // handle relative paths to be safe (might happen when process.cwd() fails)\n\n  // Normalize the path\n  resolvedPath = normalizeArray(filter(resolvedPath.split('/'), function(p) {\n    return !!p;\n  }), !resolvedAbsolute).join('/');\n\n  return ((resolvedAbsolute ? '/' : '') + resolvedPath) || '.';\n};\n\n// path.normalize(path)\n// posix version\nexports.normalize = function(path) {\n  var isAbsolute = exports.isAbsolute(path),\n      trailingSlash = substr(path, -1) === '/';\n\n  // Normalize the path\n  path = normalizeArray(filter(path.split('/'), function(p) {\n    return !!p;\n  }), !isAbsolute).join('/');\n\n  if (!path && !isAbsolute) {\n    path = '.';\n  }\n  if (path && trailingSlash) {\n    path += '/';\n  }\n\n  return (isAbsolute ? '/' : '') + path;\n};\n\n// posix version\nexports.isAbsolute = function(path) {\n  return path.charAt(0) === '/';\n};\n\n// posix version\nexports.join = function() {\n  var paths = Array.prototype.slice.call(arguments, 0);\n  return exports.normalize(filter(paths, function(p, index) {\n    if (typeof p !== 'string') {\n      throw new TypeError('Arguments to path.join must be strings');\n    }\n    return p;\n  }).join('/'));\n};\n\n\n// path.relative(from, to)\n// posix version\nexports.relative = function(from, to) {\n  from = exports.resolve(from).substr(1);\n  to = exports.resolve(to).substr(1);\n\n  function trim(arr) {\n    var start = 0;\n    for (; start < arr.length; start++) {\n      if (arr[start] !== '') break;\n    }\n\n    var end = arr.length - 1;\n    for (; end >= 0; end--) {\n      if (arr[end] !== '') break;\n    }\n\n    if (start > end) return [];\n    return arr.slice(start, end - start + 1);\n  }\n\n  var fromParts = trim(from.split('/'));\n  var toParts = trim(to.split('/'));\n\n  var length = Math.min(fromParts.length, toParts.length);\n  var samePartsLength = length;\n  for (var i = 0; i < length; i++) {\n    if (fromParts[i] !== toParts[i]) {\n      samePartsLength = i;\n      break;\n    }\n  }\n\n  var outputParts = [];\n  for (var i = samePartsLength; i < fromParts.length; i++) {\n    outputParts.push('..');\n  }\n\n  outputParts = outputParts.concat(toParts.slice(samePartsLength));\n\n  return outputParts.join('/');\n};\n\nexports.sep = '/';\nexports.delimiter = ':';\n\nexports.dirname = function(path) {\n  var result = splitPath(path),\n      root = result[0],\n      dir = result[1];\n\n  if (!root && !dir) {\n    // No dirname whatsoever\n    return '.';\n  }\n\n  if (dir) {\n    // It has a dirname, strip trailing slash\n    dir = dir.substr(0, dir.length - 1);\n  }\n\n  return root + dir;\n};\n\n\nexports.basename = function(path, ext) {\n  var f = splitPath(path)[2];\n  // TODO: make this comparison case-insensitive on windows?\n  if (ext && f.substr(-1 * ext.length) === ext) {\n    f = f.substr(0, f.length - ext.length);\n  }\n  return f;\n};\n\n\nexports.extname = function(path) {\n  return splitPath(path)[3];\n};\n\nfunction filter (xs, f) {\n    if (xs.filter) return xs.filter(f);\n    var res = [];\n    for (var i = 0; i < xs.length; i++) {\n        if (f(xs[i], i, xs)) res.push(xs[i]);\n    }\n    return res;\n}\n\n// String.prototype.substr - negative index don't work in IE8\nvar substr = 'ab'.substr(-1) === 'b'\n    ? function (str, start, len) { return str.substr(start, len) }\n    : function (str, start, len) {\n        if (start < 0) start = str.length + start;\n        return str.substr(start, len);\n    }\n;\n",
    "// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n",
    "'use strict';\r\n\r\nconst { getClasses } = require('./helpers.js');\r\n\r\nconst {\r\n\tSWITCH_CLASSES,\r\n\tFLEX_CHILD_CLASSES,\r\n\tFLEX_CLASSES,\r\n\tHEADER_CLASSES,\r\n\tSWITCH_ITEM_CLASSES,\r\n\tDIVIDER_ITEM_CLASSES,\r\n\tLABEL_ITEM_CLASSES,\r\n\tFONT_SIZE_CLASSES,\r\n} = require('./classes.js');\r\n\r\nfunction checkbox({ setting, name, description, value, change }) {\r\n\t//jscs:disable maximumLineLength\r\n\treturn $(`\r\n\t\t<div class=\"${[FLEX_CHILD_CLASSES.flex, getClasses(FLEX_CLASSES, ['vertical', 'justifyStart', 'alignStretch', 'noWrap'])].join(' ')}\" style=\"flex: 1 1 auto;\">\r\n\t\t\t<div class=\"${[getClasses(FLEX_CHILD_CLASSES, ['flex', 'horizontal']), getClasses(FLEX_CLASSES, ['justifyStart', 'alignStart', 'noWrap'])].join(' ')}\" style=\"flex: 1 1 auto;\">\r\n\t\t\t\t<h3 class=\"${[getClasses(HEADER_CLASSES, ['h3', 'defaultColor']),  SWITCH_ITEM_CLASSES.title, FLEX_CHILD_CLASSES.flexChild].join(' ')}\" style=\"flex: 1 1 auto;\">\r\n\t\t\t\t\t${name}\r\n\t\t\t\t</h3>\r\n\t\t\t\t<div class=\"${SWITCH_CLASSES.switchWrapperDefaultActive} ${FLEX_CHILD_CLASSES.flexChild}\" style=\"flex: 0 0 auto;\">\r\n\t\t\t\t\t<input type=\"checkbox\" class=\"${SWITCH_CLASSES.checkbox}\" value=\"on\">\r\n\t\t\t\t\t<div class=\"${SWITCH_CLASSES.switch} ${value ? SWITCH_CLASSES.checked : ''}\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"${[LABEL_ITEM_CLASSES.description, SWITCH_ITEM_CLASSES.note, LABEL_ITEM_CLASSES.modeDefault, FONT_SIZE_CLASSES.primary].join(' ')}\" style=\"flex: 1 1 auto; ${description ? '' : 'display: none;'}\">\r\n\t\t\t\t${description}\r\n\t\t\t</div>\r\n\t\t\t<div class=\"${DIVIDER_ITEM_CLASSES.divider} ${SWITCH_ITEM_CLASSES.divider}\"></div>\r\n\t\t</div>\r\n\t\t`) //jscs:enable maximumLineLength\r\n\t\t.on('click', function () {\r\n\t\t\tconst $this = $(this).find(`.${SWITCH_CLASSES.switch}`);\r\n\r\n\t\t\t$this.toggleClass(SWITCH_CLASSES.checked);\r\n\r\n\t\t\tif (typeof change === 'function') {\r\n\t\t\t\tchange($this.hasClass(SWITCH_CLASSES.checked));\r\n\t\t\t}\r\n\t\t});\r\n}\r\n\r\nmodule.exports = checkbox;\r\n",
    "'use strict';\r\n\r\nexports.SETTINGS_CLASSES = n(2392);\r\nexports.SWITCH_CLASSES = n(2390);\r\nexports.FLEX_CHILD_CLASSES = n(2374);\r\nexports.FLEX_CLASSES = n(2355);\r\nexports.HEADER_CLASSES = n(2401);\r\nexports.SWITCH_ITEM_CLASSES = n(2391);\r\nexports.DIVIDER_ITEM_CLASSES = n(2397);\r\nexports.LABEL_ITEM_CLASSES = n(2400);\r\nexports.FONT_SIZE_CLASSES = n(2393);\r\nexports.CARD_CLASSES = n(2366);\r\n\r\nexports.SIDEBAR_BUTTON_CLASS = 'be-settings-button';\r\nexports.SERVER_CARD_CLASSES = {\r\n\tshowInPicker: 'be-server-show-in-picker',\r\n\tshowInPickerSwitch: 'be-server-show-in-picker-switch',\r\n\tshowInServerList: 'be-server-show-in-server-list',\r\n\tshowInServerListSwitch: 'be-server-show-in-server-list-switch',\r\n\tserverCard: 'be-server-card',\r\n\ticon: 'be-server-icon',\r\n};\r\n\r\nfunction n(id) {\r\n\treturn webpackJsonp([], [], [id]);\r\n}\r\n",
    "'use strict';\r\n\r\n//jscs: disable maximumLineLength\r\nexports.API_BASE = 'https://discordapp.com/api';\r\n\r\n/* May be changed with discord updates */\r\nexports.EMOJI_PICKER_PATH = '#app-mount > div > div:nth-child(7)';\r\nexports.EMOJI_BUTTON_CLASS = n(2367).emojiButton;\r\nexports.CHANNEL_TEXTAREA_CLASS = n(2367).channelTextArea;\r\nexports.LOCAL_STORAGE_MODULE = n(1786);\r\nexports.EMOJI_STORAGE_MODULE = n(174).default;\r\nexports.SERVERS_STORAGE_MODULE = n(15);\r\nexports.SERVERS_PERMISSIONS_MODULE = n(58);\r\nexports.TRANSLATION_MODULE = n(3);\r\nexports.CUSTOM_EMOJI_STORAGE_MODULE = n(204);\r\nexports.TOKEN_KEY = n(0).TOKEN_KEY;\r\n/* May be changed with discord updates.END */\r\n\r\nexports.ELEMENT_SCROLLER_WRAP = '<div class=\"scroller-wrap tl-emoji-scroller-wrap\"><div class=\"scroller\"></div></div>';\r\n\r\nexports.ELEMENT_SEARCH_INPUT = '<input type=\"text\" placeholder=\"Find the perfect emoji\" value=\"\">';\r\n\r\nexports.ELEMENT_SERVER_EMOJI_LIST = '<span class=\"server-emojis\"><div class=\"category\">server.name</div></span>';\r\nexports.ELEMENT_SERVER_EMOJI_LIST_ROW = '<div class=\"row\"></div>';\r\nexports.ELEMENT_SERVER_EMOJI_LIST_ROW_ENTRY = '<div class=\"emoji-item\"></div>'; // max 10 per row\r\n\r\nexports.REACTION_POPOUT_REGEX = /TOGGLE_REACTION_POPOUT_(\\d+)/;\r\nexports.CURRENT_SELECTED_CHANNEL_REGEX = /.*\\/.+\\/(\\d+)/;\r\nexports.IS_INBOX_REGEX = /\\/channels\\/@me\\/\\d+/;\r\n\r\nexports.IS_NUMBER_REGEX = /\\d+/;\r\n\r\nexports.BETTER_EMOJIS_KEY = 'better-emojis';\r\n\r\n/**\r\n * Default options HTTP Fetch jQuery\r\n *\r\n * @type {Object}\r\n */\r\nexports.defaultFetchOptions = {\r\n\tmethod: 'GET'\r\n};\r\n\r\nfunction n(id) {\r\n\treturn webpackJsonp([], [], [id]);\r\n}\r\n",
    "'use strict';\r\n\r\nconst id = Symbol('id');\r\nconst name = Symbol('name');\r\nconst url = Symbol('url');\r\nconst managed = Symbol('managed');\r\nconst requireColons = Symbol('requireColons');\r\nconst roles = Symbol('roles');\r\n\r\nconst GLOBAL_EMOJI_MAP = new Map;\r\n\r\nclass Emoji {\r\n\tconstructor(\r\n\t\t_id,\r\n\t\t_name,\r\n\t\t_managed = false,\r\n\t\t_requireColons = true,\r\n\t\t_roles = [],\r\n\t\t_url = `https://cdn.discordapp.com/emojis/${_id}.png`\r\n\t) {\r\n\t\tthis[id] = _id;\r\n\t\tthis[name] = _name;\r\n\t\tthis[url] = _url;\r\n\t\tthis[managed] = _managed;\r\n\t\tthis[requireColons] = _requireColons;\r\n\t\tthis[roles] = _roles;\r\n\r\n\t\tGLOBAL_EMOJI_MAP.set(this[id], this);\r\n\t}\r\n\r\n\tget id() {\r\n\t\treturn this[id];\r\n\t}\r\n\r\n\tget name() {\r\n\t\treturn this[name];\r\n\t}\r\n\r\n\tget url() {\r\n\t\treturn this[url];\r\n\t}\r\n\r\n\tget isManaged() {\r\n\t\treturn this[managed];\r\n\t}\r\n\r\n\tget colonsRequired() {\r\n\t\treturn this[requireColons];\r\n\t}\r\n\r\n\tget roles() {\r\n\t\treturn this[roles];\r\n\t}\r\n\r\n\tget useName() {\r\n\t\treturn this.colonsRequired ? `:${this.name}:` : this.name;\r\n\t}\r\n\r\n\tstatic fromRaw(emojiRaw) {\r\n\t\treturn new Emoji(\r\n\t\t\temojiRaw.id,\r\n\t\t\temojiRaw.name,\r\n\t\t\temojiRaw.managed,\r\n\t\t\temojiRaw.requireColons,\r\n\t\t\temojiRaw.roles\r\n\t\t);\r\n\t}\r\n\r\n\tstatic getById(id) {\r\n\t\treturn GLOBAL_EMOJI_MAP.get(id);\r\n\t}\r\n}\r\n\r\nmodule.exports = Emoji;\r\n",
    "'use strict';\r\n\r\nconst { defaultFetchOptions } = require('./constants');\r\n\r\n/**\r\n * Fetch URL\r\n *\r\n * @param {Object} options\r\n *\r\n * @return {Promise<mixed>}\r\n */\r\nexports.fetchURL = function fetchURL(options) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\toptions = Object.assign({}, defaultFetchOptions, options);\r\n\r\n\t\t$.ajax(options).then(resolve).fail(reject);\r\n\t});\r\n};\r\n\r\nexports.getClasses = function getClasses(from, what) {\r\n\tif (!(what instanceof Array))\r\n\t\treturn from[what];\r\n\r\n\tconst res = [];\r\n\r\n\tfor (const key of what) {\r\n\t\tif (typeof from[key] === 'undefined') {\r\n\t\t\tconsole.warn(from, `doesn't have property ${key}. Check module numbers`);\r\n\t\t}\r\n\r\n\t\tres.push(from[key]);\r\n\t}\r\n\r\n\treturn res.join(' ');\r\n};\r\n",
    "'use strict';\r\n\r\nconst Server = require('./server.js');\r\nconst Emoji = require('./emoji.js');\r\nconst Picker = require('./picker.js');\r\nconst {\r\n\tAPI_BASE,\r\n\tTOKEN_KEY,\r\n\tTRANSLATION_MODULE,\r\n\tEMOJI_STORAGE_MODULE,\r\n\tLOCAL_STORAGE_MODULE,\r\n\tCUSTOM_EMOJI_STORAGE_MODULE,\r\n\tSERVERS_STORAGE_MODULE,\r\n\tSERVERS_PERMISSIONS_MODULE,\r\n} = require('./constants.js');\r\n\r\nfunction getServers() {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tif (!SERVERS_STORAGE_MODULE || !SERVERS_STORAGE_MODULE.getGuilds) {\r\n\t\t\treject(new Error('Server storage module is not pointing to server storage'));\r\n\t\t}\r\n\r\n\t\tconst servers = Object.values(SERVERS_STORAGE_MODULE.getGuilds());\r\n\r\n\t\tif (servers.length > 0){\r\n\t\t\tresolve(servers);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// TODO Write better realization\r\n\r\n\t\t// I do not undertand fully how this is working,\r\n\t\t// but it works much more stable then previous method\r\n\r\n\t\t// Use Discord action handlres to catch initializtion event\r\n\t\tnew (function (e) {\r\n\t\t\tfunction t() {\r\n\t\t\t\treturn e.apply(this, arguments);\r\n\t\t\t}\r\n\r\n\t\t\tt.prototype = Object.create(e && e.prototype, {\r\n\t\t\t\tconstructor: {\r\n\t\t\t\t\tvalue: t,\r\n\t\t\t\t\tenumerable: false,\r\n\t\t\t\t\twritable: true,\r\n\t\t\t\t\tconfigurable: true\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn t;\r\n\t\t}(n(2).Store))(n(4).default, {\r\n\t\t\tCONNECTION_OPEN: function ({ guilds }) {\r\n\t\t\t\tresolve(guilds);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfunction n(id) {\r\n\t\t\treturn webpackJsonp([], [], [id]);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction parseServer({ id, name }) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tif (!SERVERS_PERMISSIONS_MODULE || !SERVERS_PERMISSIONS_MODULE.getGuildPermissions) {\r\n\t\t\treject(new Error('Server permission module is not pointing to permission storage'));\r\n\t\t}\r\n\r\n\t\tif (!CUSTOM_EMOJI_STORAGE_MODULE ||\r\n\t\t\t!CUSTOM_EMOJI_STORAGE_MODULE.getDisambiguatedEmojiContext) {\r\n\t\t\treject(new Error('Custom emoji storage module is not pointing to custom emoji storage'));\r\n\t\t}\r\n\r\n\t\tconst server = new Server(id, name, SERVERS_PERMISSIONS_MODULE.getGuildPermissions(id));\r\n\t\tconst emojiContext = CUSTOM_EMOJI_STORAGE_MODULE.getDisambiguatedEmojiContext(id);\r\n\r\n\t\t// Eventually, CUSTOM_EMOJI_STORAGE_MODULE filters emojis that we can't use by itself!\r\n\t\tresolve(CUSTOM_EMOJI_STORAGE_MODULE.getGuildEmoji(`${id}`)\r\n\t\t\t.map(e => emojiContext.getById(e.id))\r\n\t\t\t.filter(e => !!e)\r\n\t\t\t.reduce(function (server, emoji) {\r\n\t\t\t\tserver.addEmoji(Emoji.fromRaw(emoji));\r\n\t\t\t\treturn server;\r\n\t\t\t}, server)\r\n\t\t);\r\n\t});\r\n}\r\n\r\nfunction parseServers(serversA) {\r\n\treturn Promise.all(serversA.map(parseServer));\r\n}\r\n\r\nfunction loadStandartEmojis() {\r\n\tlet commonEmojis = [];\r\n\r\n\tconst translation = TRANSLATION_MODULE.Messages;\r\n\tconst categories = EMOJI_STORAGE_MODULE.getCategories();\r\n\tlet $commonEmojisSpansCacheSpan = $('<span></span>');\r\n\r\n\tfor (let category of categories) {\r\n\t\tconst tr = translation[`EMOJI_CATEGORY_${category.toUpperCase()}`];\r\n\t\tconst fakeServer = new Server(tr, tr, 0x00040000);\r\n\r\n\t\tconst emojis = EMOJI_STORAGE_MODULE.getByCategory(category);\r\n\r\n\t\tfor (let emoji of emojis) {\r\n\t\t\tfakeServer.addEmoji(\r\n\t\t\t\tnew Emoji(\r\n\t\t\t\t\temoji.uniqueName,\r\n\t\t\t\t\temoji.uniqueName,\r\n\t\t\t\t\temoji.managed,\r\n\t\t\t\t\temoji.allNamesString.includes(':'),\r\n\t\t\t\t\t[],\r\n\t\t\t\t\temoji.defaultUrl\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tcommonEmojis.push(fakeServer);\r\n\t\t$commonEmojisSpansCacheSpan.append(Picker.buildServerSpan(fakeServer));\r\n\t}\r\n\r\n\treturn Promise.resolve({\r\n\t\temojis: commonEmojis,\r\n\t\tspanCache: $commonEmojisSpansCacheSpan.html()\r\n\t});\r\n}\r\n\r\nfunction doGetEmojis() {\r\n\tconst token = LOCAL_STORAGE_MODULE.impl.get(TOKEN_KEY);\r\n\r\n\t$.ajaxSetup({\r\n\t\tcrossDomain: true,\r\n\t\theaders: {\r\n\t\t\tauthorization: token\r\n\t\t}\r\n\t});\r\n\r\n\treturn getServers()\r\n\t\t.then(parseServers)\r\n\t\t.then(loadStandartEmojis)\r\n\t\t.catch(e => {\r\n\t\t\tconsole.error('Error initializing Better Emojis!\\nProbably modules order has been changed\\n', e);\r\n\t\t});\r\n}\r\n\r\nmodule.exports = doGetEmojis;\r\n",
    "/*! Clusterize.js - v0.17.6 - 2017-03-05\r\n * http://NeXTs.github.com/Clusterize.js/\r\n * Copyright (c) 2015 Denis Lukov; Licensed GPLv3 */\r\n\r\n;\r\n(function (name, definition) {\r\n\tif (typeof module !== 'undefined') module.exports = definition();\r\n\telse if (typeof define === 'function' && typeof define.amd === 'object') define(definition);\r\n\telse this[name] = definition();\r\n}('Clusterize', function () {\r\n\r\n\t'use strict'\r\n\r\n\t// detect ie9 and lower\r\n\t// https://gist.github.com/padolsey/527683#comment-786682\r\n\tvar ie = (function () {\r\n\t\t\tfor (var v = 3,\r\n\t\t\t\t\tel = document.createElement('b'),\r\n\t\t\t\t\tall = el.all || []; el.innerHTML = '<!--[if gt IE ' + (++v) + ']><i><![endif]-->',\r\n\t\t\t\tall[0];\r\n\t\t\t) {}\r\n\r\n\t\t\treturn v > 4 ? v : document.documentMode;\r\n\t\t}()),\r\n\r\n\t\tis_mac = navigator.platform.toLowerCase().indexOf('mac') + 1;\r\n\tvar Clusterize = function (data) {\r\n\t\tif (!(this instanceof Clusterize)) {\r\n\t\t\treturn new Clusterize(data);\r\n\t\t}\r\n\r\n\t\tvar self = this;\r\n\r\n\t\tvar defaults = {\r\n\t\t\trows_in_block: 50,\r\n\t\t\tblocks_in_cluster: 4,\r\n\t\t\ttag: null,\r\n\t\t\tshow_no_data_row: true,\r\n\t\t\tno_data_class: 'clusterize-no-data',\r\n\t\t\tno_data_text: 'No data',\r\n\t\t\tkeep_parity: true,\r\n\t\t\tcallbacks: {}\r\n\t\t};\r\n\r\n\t\t// public parameters\r\n\t\tself.options = {};\r\n\t\tvar options = ['rows_in_block', 'blocks_in_cluster', 'show_no_data_row', 'no_data_class', 'no_data_text', 'keep_parity', 'tag', 'callbacks'];\r\n\t\tfor (var i = 0, option; option = options[i]; i++) {\r\n\t\t\tself.options[option] = typeof data[option] !== 'undefined' && data[option] != null ?\r\n\t\t\t\tdata[option] :\r\n\t\t\t\tdefaults[option];\r\n\t\t}\r\n\r\n\t\tvar elems = ['scroll', 'content'];\r\n\t\tfor (var i = 0, elem; elem = elems[i]; i++) {\r\n\t\t\tself[elem + '_elem'] = data[elem + 'Id'] ?\r\n\t\t\t\tdocument.getElementById(data[elem + 'Id']) :\r\n\t\t\t\tdata[elem + 'Elem'];\r\n\t\t\tif (!self[elem + '_elem']) {\r\n\t\t\t\tthrow new Error('Error! Could not find ' + elem + ' element');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// tabindex forces the browser to keep focus on the scrolling list, fixes #11\r\n\t\tif (!self.content_elem.hasAttribute('tabindex')) {\r\n\t\t\tself.content_elem.setAttribute('tabindex', 0);\r\n\t\t}\r\n\r\n\t\t// private parameters\r\n\t\tvar rows = isArray(data.rows) ?\r\n\t\t\tdata.rows :\r\n\t\t\tself.fetchMarkup(),\r\n\t\t\tcache = {},\r\n\t\t\tscroll_top = self.scroll_elem.scrollTop;\r\n\r\n\t\t// append initial data\r\n\t\tself.insertToDOM(rows, cache);\r\n\r\n\t\t// restore the scroll position\r\n\t\tself.scroll_elem.scrollTop = scroll_top;\r\n\r\n\t\t// adding scroll handler\r\n\t\tvar last_cluster = false,\r\n\t\t\tscroll_debounce = 0,\r\n\t\t\tpointer_events_set = false,\r\n\t\t\tscrollEv = function () {\r\n\t\t\t\t// fixes scrolling issue on Mac #3\r\n\t\t\t\tif (is_mac) {\r\n\t\t\t\t\tif (!pointer_events_set) self.content_elem.style.pointerEvents = 'none';\r\n\t\t\t\t\tpointer_events_set = true;\r\n\t\t\t\t\tclearTimeout(scroll_debounce);\r\n\t\t\t\t\tscroll_debounce = setTimeout(function () {\r\n\t\t\t\t\t\tself.content_elem.style.pointerEvents = 'auto';\r\n\t\t\t\t\t\tpointer_events_set = false;\r\n\t\t\t\t\t}, 50);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (last_cluster != (last_cluster = self.getClusterNum())) {\r\n\t\t\t\t\tself.insertToDOM(rows, cache);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (self.options.callbacks.scrollingProgress) {\r\n\t\t\t\t\tself.options.callbacks.scrollingProgress(self.getScrollProgress());\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tresize_debounce = 0,\r\n\t\t\tresizeEv = function () {\r\n\t\t\t\tclearTimeout(resize_debounce);\r\n\t\t\t\tresize_debounce = setTimeout(self.refresh, 100);\r\n\t\t\t};\r\n\r\n\t\ton('scroll', self.scroll_elem, scrollEv);\r\n\t\ton('resize', window, resizeEv);\r\n\r\n\t\t// public methods\r\n\t\tself.destroy = function (clean) {\r\n\t\t\toff('scroll', self.scroll_elem, scrollEv);\r\n\t\t\toff('resize', window, resizeEv);\r\n\t\t\tself.html((clean ? self.generateEmptyRow() : rows).join(''));\r\n\t\t};\r\n\r\n\t\tself.refresh = function (force) {\r\n\t\t\tif (self.getRowsHeight(rows) || force) self.update(rows);\r\n\t\t};\r\n\r\n\t\tself.update = function (new_rows) {\r\n\t\t\trows = isArray(new_rows) ?\r\n\t\t\t\tnew_rows :\r\n\t\t\t\t[]\r\n\t\t\tvar scroll_top = self.scroll_elem.scrollTop\r\n\t\t\t// fixes #39\r\n\t\t\tif (rows.length * self.options.item_height < scroll_top) {\r\n\t\t\t\tself.scroll_elem.scrollTop = 0\r\n\t\t\t\tlast_cluster = 0\r\n\t\t\t}\r\n\t\t\tself.insertToDOM(rows, cache)\r\n\t\t\tself.scroll_elem.scrollTop = scroll_top\r\n\t\t}\r\n\t\tself.clear = function() {\r\n\t\t\tself.update([])\r\n\t\t}\r\n\t\tself.getRowsAmount = function() {\r\n\t\t\treturn rows.length\r\n\t\t}\r\n\t\tself.getScrollProgress = function() {\r\n\t\t\treturn this.options.scroll_top / (rows.length * this.options.item_height) * 100 || 0\r\n\t\t}\r\n\r\n\t\tvar add = function(where, _new_rows) {\r\n\t\t\tvar new_rows = isArray(_new_rows) ?\r\n\t\t\t\t_new_rows :\r\n\t\t\t\t[]\r\n\t\t\tif (!new_rows.length) return\r\n\t\t\trows = where == 'append' ?\r\n\t\t\t\trows.concat(new_rows) :\r\n\t\t\t\tnew_rows.concat(rows)\r\n\t\t\tself.insertToDOM(rows, cache)\r\n\t\t}\r\n\t\tself.append = function(rows) {\r\n\t\t\tadd('append', rows)\r\n\t\t}\r\n\t\tself.prepend = function(rows) {\r\n\t\t\tadd('prepend', rows)\r\n\t\t}\r\n\t}\r\n\r\n\tClusterize.prototype = {\r\n\t\tconstructor: Clusterize,\r\n\t\t// fetch existing markup\r\n\t\tfetchMarkup: function() {\r\n\t\t\tvar rows = [],\r\n\t\t\t\trows_nodes = this.getChildNodes(this.content_elem)\r\n\t\t\twhile (rows_nodes.length) {\r\n\t\t\t\trows.push(rows_nodes.shift().outerHTML)\r\n\t\t\t}\r\n\t\t\treturn rows\r\n\t\t},\r\n\t\t// get tag name, content tag name, tag height, calc cluster height\r\n\t\texploreEnvironment: function(rows, cache) {\r\n\t\t\tvar opts = this.options\r\n\t\t\topts.content_tag = this.content_elem.tagName.toLowerCase()\r\n\t\t\tif (!rows.length) return\r\n\t\t\tif (ie && ie <= 9 && !opts.tag) opts.tag = rows[0].match(/<([^>\\s/]*)/)[1].toLowerCase()\r\n\t\t\tif (this.content_elem.children.length <= 1) cache.data = this.html(rows[0] + rows[0] + rows[0])\r\n\t\t\tif (!opts.tag) opts.tag = this.content_elem.children[0].tagName.toLowerCase()\r\n\t\t\tthis.getRowsHeight(rows)\r\n\t\t},\r\n\t\tgetRowsHeight: function(rows) {\r\n\t\t\tvar opts = this.options,\r\n\t\t\t\tprev_item_height = opts.item_height\r\n\t\t\topts.cluster_height = 0\r\n\t\t\tif (!rows.length) return\r\n\t\t\tvar nodes = this.content_elem.children\r\n\t\t\tvar node = nodes[Math.floor(nodes.length / 2)]\r\n\t\t\topts.item_height = node.offsetHeight\r\n\t\t\t// consider table's border-spacing\r\n\t\t\tif (opts.tag == 'tr' && getStyle('borderCollapse', this.content_elem) != 'collapse') {\r\n\t\t\t\topts.item_height += parseInt(getStyle('borderSpacing', this.content_elem), 10) || 0\r\n\t\t\t}\r\n\t\t\t// consider margins (and margins collapsing)\r\n\t\t\tif (opts.tag != 'tr') {\r\n\t\t\t\tvar marginTop = parseInt(getStyle('marginTop', node), 10) || 0\r\n\t\t\t\tvar marginBottom = parseInt(getStyle('marginBottom', node), 10) || 0\r\n\t\t\t\topts.item_height += Math.max(marginTop, marginBottom)\r\n\t\t\t}\r\n\t\t\topts.block_height = opts.item_height * opts.rows_in_block\r\n\t\t\topts.rows_in_cluster = opts.blocks_in_cluster * opts.rows_in_block\r\n\t\t\topts.cluster_height = opts.blocks_in_cluster * opts.block_height\r\n\t\t\treturn prev_item_height != opts.item_height\r\n\t\t},\r\n\t\t// get current cluster number\r\n\t\tgetClusterNum: function() {\r\n\t\t\tthis.options.scroll_top = this.scroll_elem.scrollTop\r\n\t\t\treturn Math.floor(this.options.scroll_top / (this.options.cluster_height - this.options.block_height)) || 0\r\n\t\t},\r\n\t\t// generate empty row if no data provided\r\n\t\tgenerateEmptyRow: function() {\r\n\t\t\tvar opts = this.options\r\n\t\t\tif (!opts.tag || !opts.show_no_data_row) return []\r\n\t\t\tvar empty_row = document.createElement(opts.tag),\r\n\t\t\t\tno_data_content = document.createTextNode(opts.no_data_text),\r\n\t\t\t\ttd\r\n\t\t\tempty_row.className = opts.no_data_class\r\n\t\t\tif (opts.tag == 'tr') {\r\n\t\t\t\ttd = document.createElement('td')\r\n\t\t\t\t// fixes #53\r\n\t\t\t\ttd.colSpan = 100\r\n\t\t\t\ttd.appendChild(no_data_content)\r\n\t\t\t}\r\n\t\t\tempty_row.appendChild(td || no_data_content)\r\n\t\t\treturn [empty_row.outerHTML]\r\n\t\t},\r\n\t\t// generate cluster for current scroll position\r\n\t\tgenerate: function(rows, cluster_num) {\r\n\t\t\tvar opts = this.options,\r\n\t\t\t\trows_len = rows.length\r\n\t\t\tif (rows_len < opts.rows_in_block) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttop_offset: 0,\r\n\t\t\t\t\tbottom_offset: 0,\r\n\t\t\t\t\trows_above: 0,\r\n\t\t\t\t\trows: rows_len ? rows : this.generateEmptyRow()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar items_start = Math.max((opts.rows_in_cluster - opts.rows_in_block) * cluster_num, 0),\r\n\t\t\t\titems_end = items_start + opts.rows_in_cluster,\r\n\t\t\t\ttop_offset = Math.max(items_start * opts.item_height, 0),\r\n\t\t\t\tbottom_offset = Math.max((rows_len - items_end) * opts.item_height, 0),\r\n\t\t\t\tthis_cluster_rows = [],\r\n\t\t\t\trows_above = items_start\r\n\t\t\tif (top_offset < 1) {\r\n\t\t\t\trows_above++\r\n\t\t\t}\r\n\t\t\tfor (var i = items_start; i < items_end; i++) {\r\n\t\t\t\trows[i] && this_cluster_rows.push(rows[i])\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\ttop_offset: top_offset,\r\n\t\t\t\tbottom_offset: bottom_offset,\r\n\t\t\t\trows_above: rows_above,\r\n\t\t\t\trows: this_cluster_rows\r\n\t\t\t}\r\n\t\t},\r\n\t\trenderExtraTag: function(class_name, height) {\r\n\t\t\tvar tag = document.createElement(this.options.tag),\r\n\t\t\t\tclusterize_prefix = 'clusterize-'\r\n\t\t\ttag.className = [clusterize_prefix + 'extra-row', clusterize_prefix + class_name].join(' ')\r\n\t\t\theight && (tag.style.height = height + 'px')\r\n\t\t\treturn tag.outerHTML\r\n\t\t},\r\n\t\t// if necessary verify data changed and insert to DOM\r\n\t\tinsertToDOM: function(rows, cache) {\r\n\t\t\t// explore row's height\r\n\t\t\tif (!this.options.cluster_height) {\r\n\t\t\t\tthis.exploreEnvironment(rows, cache)\r\n\t\t\t}\r\n\t\t\tvar data = this.generate(rows, this.getClusterNum()),\r\n\t\t\t\tthis_cluster_rows = data.rows.join(''),\r\n\t\t\t\tthis_cluster_content_changed = this.checkChanges('data', this_cluster_rows, cache),\r\n\t\t\t\ttop_offset_changed = this.checkChanges('top', data.top_offset, cache),\r\n\t\t\t\tonly_bottom_offset_changed = this.checkChanges('bottom', data.bottom_offset, cache),\r\n\t\t\t\tcallbacks = this.options.callbacks,\r\n\t\t\t\tlayout = []\r\n\r\n\t\t\tif (this_cluster_content_changed || top_offset_changed) {\r\n\t\t\t\tif (data.top_offset) {\r\n\t\t\t\t\tthis.options.keep_parity && layout.push(this.renderExtraTag('keep-parity'))\r\n\t\t\t\t\tlayout.push(this.renderExtraTag('top-space', data.top_offset))\r\n\t\t\t\t}\r\n\t\t\t\tlayout.push(this_cluster_rows)\r\n\t\t\t\tdata.bottom_offset && layout.push(this.renderExtraTag('bottom-space', data.bottom_offset))\r\n\t\t\t\tcallbacks.clusterWillChange && callbacks.clusterWillChange()\r\n\t\t\t\tthis.html(layout.join(''))\r\n\t\t\t\tthis.options.content_tag == 'ol' && this.content_elem.setAttribute('start', data.rows_above)\r\n\t\t\t\tcallbacks.clusterChanged && callbacks.clusterChanged()\r\n\t\t\t} else if (only_bottom_offset_changed) {\r\n\t\t\t\tthis.content_elem.lastChild.style.height = data.bottom_offset + 'px'\r\n\t\t\t}\r\n\t\t},\r\n\t\t// unfortunately ie <= 9 does not allow to use innerHTML for table elements, so make a workaround\r\n\t\thtml: function(data) {\r\n\t\t\tvar content_elem = this.content_elem\r\n\t\t\tif (ie && ie <= 9 && this.options.tag == 'tr') {\r\n\t\t\t\tvar div = document.createElement('div'),\r\n\t\t\t\t\tlast\r\n\t\t\t\tdiv.innerHTML = '<table><tbody>' + data + '</tbody></table>'\r\n\t\t\t\twhile ((last = content_elem.lastChild)) {\r\n\t\t\t\t\tcontent_elem.removeChild(last)\r\n\t\t\t\t}\r\n\t\t\t\tvar rows_nodes = this.getChildNodes(div.firstChild.firstChild)\r\n\t\t\t\twhile (rows_nodes.length) {\r\n\t\t\t\t\tcontent_elem.appendChild(rows_nodes.shift())\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcontent_elem.innerHTML = data\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetChildNodes: function(tag) {\r\n\t\t\tvar child_nodes = tag.children,\r\n\t\t\t\tnodes = []\r\n\t\t\tfor (var i = 0, ii = child_nodes.length; i < ii; i++) {\r\n\t\t\t\tnodes.push(child_nodes[i])\r\n\t\t\t}\r\n\t\t\treturn nodes\r\n\t\t},\r\n\t\tcheckChanges: function(type, value, cache) {\r\n\t\t\tvar changed = value != cache[type]\r\n\t\t\tcache[type] = value\r\n\t\t\treturn changed\r\n\t\t}\r\n\t}\r\n\r\n\t// support functions\r\n\tfunction on(evt, element, fnc) {\r\n\t\treturn element.addEventListener ? element.addEventListener(evt, fnc, false) : element.attachEvent('on' + evt, fnc)\r\n\t}\r\n\r\n\tfunction off(evt, element, fnc) {\r\n\t\treturn element.removeEventListener ? element.removeEventListener(evt, fnc, false) : element.detachEvent('on' + evt, fnc)\r\n\t}\r\n\r\n\tfunction isArray(arr) {\r\n\t\treturn Object.prototype.toString.call(arr) === '[object Array]'\r\n\t}\r\n\r\n\tfunction getStyle(prop, elem) {\r\n\t\treturn window.getComputedStyle ? window.getComputedStyle(elem)[prop] : elem.currentStyle[prop]\r\n\t}\r\n\r\n\treturn Clusterize\r\n}))\r\n",
    "'use strict';\r\n\r\nconst Picker = require('./picker.js');\r\nconst SettingsPanel = require('./settings-panel.js');\r\nconst Settings = require('./settings.js');\r\nconst Observer = require('./observer.js').ChildAddRemoveObserver;\r\nconst {\r\n\tEMOJI_PICKER_PATH,\r\n\tEMOJI_BUTTON_CLASS,\r\n} = require('./constants.js');\r\n\r\nconst initEmojis = require('./initializer.js');\r\n\r\nfunction attachPickerObserver() {\r\n\tif (window.better_emojis.pickerObserver) {\r\n\t\twindow.better_emojis.pickerObserver.disconnect();\r\n\t} else {\r\n\t\twindow.better_emojis.pickerObserver = new Observer(null,\r\n\t\t\t() => {\r\n\t\t\t\tif (!Settings.get('enabled')) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet isPickerOpened = !!$(EMOJI_PICKER_PATH).find('.emoji-picker').length;\r\n\t\t\t\tlet isInlineOrTextareaPicker =\r\n\t\t\t\t\t$(`.${EMOJI_BUTTON_CLASS}`).hasClass('popout-open') ||\r\n\t\t\t\t\t!!$('.btn-reaction.popout-open').length;\r\n\t\t\t\tif (isPickerOpened && isInlineOrTextareaPicker) {\r\n\t\t\t\t\tPicker.show();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t() => {\r\n\t\t\t\tif (window.better_emojis.current_cluster) {\r\n\t\t\t\t\twindow.better_emojis.current_cluster.destroy();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\twindow.better_emojis.pickerObserver.reattach = attachPickerObserver;\r\n\twindow.better_emojis.pickerObserver.observe($(EMOJI_PICKER_PATH)[0]);\r\n}\r\n\r\nfunction attachSettingsObserver() {\r\n\tif (window.better_emojis.settingsObserver) {\r\n\t\twindow.better_emojis.settingsObserver.disconnect();\r\n\t} else {\r\n\t\twindow.better_emojis.settingsObserver = new Observer(null,\r\n\t\t\t(mutation) => {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tSettingsPanel.inject(mutation.addedNodes[0]);\r\n\t\t\t\t}, 30);\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\twindow.better_emojis.settingsObserver.reattach = attachPickerObserver;\r\n\twindow.better_emojis.settingsObserver.observe($('.layers')[0]);\r\n}\r\n\r\ninitEmojis().then((spanCache) => {\r\n\tPicker.setCommonEmojiSpanCache(spanCache.spanCache);\r\n\tsetTimeout(() => {\r\n\t\tattachPickerObserver();\r\n\t\tattachSettingsObserver();\r\n\t\tSettingsPanel.updateHiddenServers();\r\n\t\tconsole.log('Better Emojis initialized');\r\n\t}, 2000);\r\n});\r\n",
    "'use strict';\r\n\r\nconst observer = Symbol('observer');\r\nconst addListeners = Symbol('addListeners');\r\nconst removeListeners = Symbol('removeListeners');\r\n\r\nclass ChildAddRemoveObserver {\r\n\tconstructor(target = null, addListener = null, removeListener = null) {\r\n\t\tthis[observer] = new MutationObserver(([mutation]) => {\r\n\t\t\tif (mutation.type !== 'childList') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (mutation.addedNodes.length > 0) {\r\n\t\t\t\tfor (const listener of this[addListeners]) {\r\n\t\t\t\t\tlistener(mutation);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (mutation.removedNodes.length > 0) {\r\n\t\t\t\tfor (const listener of this[removeListeners]) {\r\n\t\t\t\t\tlistener(mutation);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis[addListeners] = [];\r\n\t\tthis[removeListeners] = [];\r\n\r\n\t\tif (target) {\r\n\t\t\tthis.observe(target);\r\n\t\t}\r\n\r\n\t\tthis.add(addListener).remove(removeListener);\r\n\t}\r\n\r\n\tobserve(target) {\r\n\t\tif (!target || !(target instanceof Node)) {\r\n\t\t\tthrow new TypeError('Target must be Node!');\r\n\t\t}\r\n\r\n\t\tthis[observer].observe(target, {\r\n\t\t\tchildList: true\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tadd(listener) {\r\n\t\treturn this.on('add', listener);\r\n\t}\r\n\r\n\tremove(listener) {\r\n\t\treturn this.on('remove', listener);\r\n\t}\r\n\r\n\ton(evt, listener) {\r\n\t\tif (!listener) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (typeof listener !== 'function') {\r\n\t\t\tthrow new TypeError('Listener must be function');\r\n\t\t}\r\n\r\n\t\tswitch (evt) {\r\n\t\t\tcase 'add':\r\n\t\t\t\tthis[addListeners].push(listener);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'remove':\r\n\t\t\t\tthis[removeListeners].push(listener);\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff(evt) {\r\n\t\tswitch (evt) {\r\n\t\t\tcase 'add':\r\n\t\t\t\tthis[addListeners] = [];\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'remove':\r\n\t\t\t\tthis[removeListeners] = [];\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdisconnect() {\r\n\t\tthis[observer].disconnect();\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\nmodule.exports.ChildAddRemoveObserver = ChildAddRemoveObserver;\r\n",
    "'use strict';\r\n\r\nconst Clusterize = require('./lib/clusterize.js');\r\nconst Emoji = require('./emoji.js');\r\nconst Server = require('./server.js');\r\nconst Settings = require('./settings.js');\r\n\r\nconst { fetchURL } = require('./helpers');\r\nconst {\r\n\tAPI_BASE,\r\n\tIS_NUMBER_REGEX,\r\n\tEMOJI_PICKER_PATH,\r\n\tELEMENT_SCROLLER_WRAP,\r\n\tREACTION_POPOUT_REGEX,\r\n\tELEMENT_SERVER_EMOJI_LIST,\r\n\tELEMENT_SERVER_EMOJI_LIST_ROW,\r\n\tCURRENT_SELECTED_CHANNEL_REGEX,\r\n\tELEMENT_SERVER_EMOJI_LIST_ROW_ENTRY,\r\n\tEMOJI_BUTTON_CLASS,\r\n\tCHANNEL_TEXTAREA_CLASS,\r\n\tCUSTOM_EMOJI_STORAGE_MODULE,\r\n} = require('./constants.js');\r\n\r\nlet commonEmojisSpansCache = '';\r\n\r\nlet SCROLLER_WRAP = null;\r\nlet SCROLLER_WRAP_OLD = null;\r\nlet SEARCH_INPUT = null;\r\n\r\nfunction buildScrollerWrap() {\r\n\tconst $wrap = SCROLLER_WRAP || $(ELEMENT_SCROLLER_WRAP);\r\n\tconst $scr = $wrap.find('.scroller');\r\n\r\n\t$scr.html(' ').off('click').off('mouseenter').off('mouseleave');\r\n\r\n\tconst currentServer = Server.getCurrentServer();\r\n\r\n\t// Append all current server emojis, if any\r\n\tif (currentServer.emojis.length > 0) {\r\n\t\t$scr.append(buildServerSpan(currentServer));\r\n\t}\r\n\r\n\t// Append all other server shared emojis\r\n\tif (currentServer.canUseExternalEmojis) {\r\n\t\tfor (const server of Server.getAllServers()) {\r\n\t\t\tlet availableEmojis = server.availableEmojis();\r\n\t\t\tif (!server.isCurrent()\r\n\t\t\t\t&& server.isShownInPicker()\r\n\t\t\t\t&& IS_NUMBER_REGEX.test(server.id)\r\n\t\t\t\t&& availableEmojis.length > 0\r\n\t\t\t) {\r\n\t\t\t\t$scr.append(buildServerSpan(server, availableEmojis));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Append common emojis\r\n\tif (commonEmojisSpansCache) {\r\n\t\t$scr.append(commonEmojisSpansCache);\r\n\t}\r\n\r\n\twindow.better_emojis.current_cluster = new Clusterize({\r\n\t\trows_in_block: 10,\r\n\t\tblocks_in_cluster: 3,\r\n\t\tscrollElem: $scr[0],\r\n\t\tcontentElem: $scr[0]\r\n\t});\r\n\r\n\tconst serverContext = CUSTOM_EMOJI_STORAGE_MODULE.getDisambiguatedEmojiContext(currentServer.id);\r\n\r\n\tconst emojiClickHandler = $(`.${EMOJI_BUTTON_CLASS}`).hasClass('popout-open')\r\n\t\t? putEmojiInTextarea\r\n\t\t: addCurrentMessageReaction;\r\n\r\n\t$scr\r\n\t.on('click', '.emoji-item', e => {\r\n\t\tconsole.log('Selected emoji - ', Emoji.getById($(e.target).attr('data-emoji')));\r\n\t})\r\n\t.on('click', '.emoji-item', e => {\r\n\t\temojiClickHandler(serverContext.getById($(e.target).attr('data-emoji')));\r\n\t})\r\n\t.on('mouseenter', '.emoji-item', e => {\r\n\t\t$(e.target).addClass('selected');\r\n\r\n\t\tif (SEARCH_INPUT) {\r\n\t\t\tSEARCH_INPUT.attr('placeholder', Emoji.getById($(e.target).attr('data-emoji')).useName);\r\n\t\t}\r\n\t})\r\n\t.on('mouseleave', '.emoji-item', e => {\r\n\t\t$(e.target).removeClass('selected');\r\n\r\n\t\tif (SEARCH_INPUT) {\r\n\t\t\tSEARCH_INPUT.attr('placeholder', 'Find the perfect emoji');\r\n\t\t}\r\n\t});\r\n\r\n\treturn $wrap;\r\n}\r\n\r\nfunction buildServerSpan(server, availableEmojis) {\r\n\tconst $emojiList = $(ELEMENT_SERVER_EMOJI_LIST);\r\n\tconst emojis = availableEmojis || server.availableEmojis();\r\n\r\n\t$emojiList.find('.category').html(server.name);\r\n\t$emojiList.append(buildEmojisRows(emojis));\r\n\r\n\treturn $emojiList.html();\r\n}\r\n\r\nfunction buildEmojisRows(eL) {\r\n\tconst $emojiList = $('<span class=\"tl-emoji-list\"></span>');\r\n\tlet $emojiListRow = $(ELEMENT_SERVER_EMOJI_LIST_ROW);\r\n\r\n\tconst emojiElement = function (emoji) {\r\n\t\treturn $(ELEMENT_SERVER_EMOJI_LIST_ROW_ENTRY)\r\n\t\t\t.css('background-image', `url(\"${emoji.url}\")`)\r\n\t\t\t.attr('data-emoji', `${emoji.id}`);\r\n\t};\r\n\r\n\tfor (let i = 0; i < eL.length; i++) {\r\n\t\tif ((i !== 0) && (i % 10 === 0)) {\r\n\t\t\t$emojiList.append($emojiListRow);\r\n\t\t\t$emojiListRow = $(ELEMENT_SERVER_EMOJI_LIST_ROW);\r\n\t\t}\r\n\r\n\t\t$emojiListRow.append(emojiElement(eL[i]));\r\n\t}\r\n\r\n\t$emojiList.append($emojiListRow);\r\n\r\n\treturn $emojiList.html();\r\n}\r\n\r\nfunction putEmojiInTextarea(emoji) {\r\n\tconst $textarea = $(`.${CHANNEL_TEXTAREA_CLASS} >> textarea`);\r\n\r\n\t$textarea.val($textarea.val() + (emoji.require_colons ? `:${emoji.name}:` : emoji.name));\r\n}\r\n\r\nfunction findReact(dom) {\r\n\tfor (const key in dom) {\r\n\t\tif (key.startsWith('__reactInternalInstance$')) {\r\n\t\t\treturn dom[key];\r\n\t\t}\r\n\t}\r\n\r\n\treturn null;\r\n};\r\n\r\nfunction getSelectedMessageId() {\r\n\ttry {\r\n\t\treturn REACTION_POPOUT_REGEX.exec(\r\n\t\t\tfindReact($('.btn-reaction.popout-open').closest('.message').find('.message-text').get(0))\r\n\t\t\t._currentElement.props.children\r\n\t\t\t.filter(c => (\r\n\t\t\t\tObject.keys(c.props).includes('subscribeTo')\r\n\t\t\t))[0].props.subscribeTo\r\n\t\t)[1];\r\n\t} catch (e) {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nfunction getCurrentSelectedChannel() {\r\n\treturn CURRENT_SELECTED_CHANNEL_REGEX.exec(window.location.pathname)[1];\r\n}\r\n\r\nfunction addCurrentMessageReaction(emoji) {\r\n\treturn addMessageReaction(getCurrentSelectedChannel(), getSelectedMessageId(), emoji);\r\n}\r\n\r\nfunction addMessageReaction(channel, message, emoji) {\r\n\treturn fetchURL({\r\n\t\turl: `${API_BASE}/channels/${channel}/messages/${message}/reactions/:${emoji.name}:${emoji.id}/@me`, //jscs:disable maximumLineLength\r\n\t\tmethod: 'PUT',\r\n\t\tdataType: 'json',\r\n\t});\r\n}\r\n\r\nfunction showOriginalScroller() {\r\n\tSCROLLER_WRAP.hide().parent();\r\n\tSCROLLER_WRAP_OLD.show();\r\n}\r\n\r\nfunction showCustomScroller() {\r\n\tSCROLLER_WRAP.show();\r\n\tSCROLLER_WRAP_OLD.hide();\r\n\tSCROLLER_WRAP.find('.scroller').scrollTop(0);\r\n}\r\n\r\nfunction replaceScroller() {\r\n\tSCROLLER_WRAP = buildScrollerWrap();\r\n\tSCROLLER_WRAP_OLD = $(EMOJI_PICKER_PATH).find('.scroller-wrap');\r\n\tSCROLLER_WRAP_OLD.hide().before(SCROLLER_WRAP);\r\n}\r\n\r\nfunction replaceSearchInput() {\r\n\t// SEARCH_INPUT = buildSearchInput();\r\n\t// $(EMOJI_PICKER_PATH).find(\"input\").hide().before(SEARCH_INPUT);\r\n\t// Temporary disabled, as original search have much better performance\r\n\tlet $picker = $(EMOJI_PICKER_PATH);\r\n\tSEARCH_INPUT = $picker.find('input');\r\n\r\n\tSEARCH_INPUT.on('change keydown keyup paste', () => {\r\n\t\tlet $wrap = $picker.find('.scroller-wrap, .no-search-results');\r\n\r\n\t\tif (SEARCH_INPUT.val()) {\r\n\t\t\t$wrap.filter('.tl-emoji-scroller-wrap').hide();\r\n\t\t\t$wrap.not('.tl-emoji-scroller-wrap').show();\r\n\t\t} else {\r\n\t\t\t$wrap.filter('.tl-emoji-scroller-wrap').show();\r\n\t\t\t$wrap.not('.tl-emoji-scroller-wrap').hide();\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction addCustomScrollerParts() {\r\n\t// console.log(\"picker opened\");\r\n\r\n\tsetTimeout(() => {\r\n\t\tsetTimeout(showCustomScroller, 10);\r\n\r\n\t\treplaceScroller();\r\n\t\treplaceSearchInput();\r\n\r\n\t\tconst categories = $(EMOJI_PICKER_PATH).find('.categories');\r\n\t\tconst categoriesChildren = categories.children();\r\n\t\tconst customScroller = ['recent', 'custom'];\r\n\r\n\t\tcategories.on('click', '.item', function (event) {\r\n\t\t\tconst $this = $(this);\r\n\r\n\t\t\tcategoriesChildren.removeClass('selected');\r\n\t\t\t$this.addClass('selected');\r\n\r\n\t\t\tcustomScroller.forEach(function (category) {\r\n\t\t\t\tif ($this.hasClass(category)) {\r\n\t\t\t\t\tshowCustomScroller.call(this, event);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tshowOriginalScroller.call(this, event);\r\n\t\t});\r\n\r\n\t}, 20);\r\n}\r\n\r\nmodule.exports.buildServerSpan = buildServerSpan;\r\nmodule.exports.show = addCustomScrollerParts;\r\n\r\nmodule.exports.setCommonEmojiSpanCache = function (cache) {\r\n\tcommonEmojisSpansCache = cache;\r\n};\r\n",
    "'use strict';\r\n\r\nconst Emoji = require('./emoji.js');\r\nconst Settings = require('./settings.js');\r\n\r\nconst GLOBAL_SERVER_LIST = [];\r\n\r\nconst id = Symbol('id');\r\nconst name = Symbol('name');\r\nconst emojis = Symbol('emojis');\r\nconst sharedEmojis = Symbol('sharedEmojis');\r\nconst permissions = Symbol('permissions');\r\nconst serverRegex = Symbol('serverRegex');\r\n\r\nclass Server {\r\n\tconstructor(_id, _name, _permissions, _emojis = [], _sharedEmojis = []) {\r\n\t\tif (GLOBAL_SERVER_LIST.some(s => s.id === _id)) {\r\n\t\t\tthrow new Error('Cannot have multiple servers with same id!');\r\n\t\t}\r\n\r\n\t\tthis[id] = _id;\r\n\t\tthis[name] = _name;\r\n\t\tthis[permissions] = _permissions;\r\n\t\tthis[emojis] = _emojis;\r\n\t\tthis[sharedEmojis] = _sharedEmojis;\r\n\t\tthis[serverRegex] = new RegExp(`.*/${_id.toString()}/\\\\d+`);\r\n\r\n\t\tGLOBAL_SERVER_LIST.push(this);\r\n\t}\r\n\r\n\taddEmoji(emoji) {\r\n\t\tif (!(emoji instanceof Emoji)) {\r\n\t\t\tthrow new TypeError('Only objects of class Emoji can be added using this method');\r\n\t\t}\r\n\r\n\t\tif (this[emojis].some(e => e.id === emoji.id)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis[emojis].push(emoji);\r\n\r\n\t\tif (emoji.isManaged) {\r\n\t\t\tthis[sharedEmojis].push(emoji);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tget canUseExternalEmojis() {\r\n\t\treturn this[permissions] & 0x00040000;\r\n\t}\r\n\r\n\tget id() {\r\n\t\treturn this[id];\r\n\t}\r\n\r\n\tget name() {\r\n\t\treturn this[name];\r\n\t}\r\n\r\n\tget permissions() {\r\n\t\treturn this[permissions];\r\n\t}\r\n\r\n\tget emojis() {\r\n\t\treturn this[emojis];\r\n\t}\r\n\r\n\tget sharedEmojis() {\r\n\t\treturn this[sharedEmojis];\r\n\t}\r\n\r\n\tisGuild() {\r\n\t\treturn /\\d+/.test(this[id]);\r\n\t}\r\n\r\n\tisCurrent() {\r\n\t\treturn this[serverRegex].test(window.location);\r\n\t}\r\n\r\n\tavailableEmojis() {\r\n\t\tconst emojiList = this.isCurrent() ? this.emojis : this.sharedEmojis;\r\n\t\treturn emojiList.filter(e => Settings.get(`picker.emoji.enabled.${e.id}`, true));\r\n\t}\r\n\r\n\tpossibleEmojis() {\r\n\t\tconst list = this.emojis;\r\n\r\n\t\tfor (const server of GLOBAL_SERVER_LIST) {\r\n\t\t\tif (server.id === this.id) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlist.push(...server.sharedEmojis);\r\n\t\t}\r\n\r\n\t\treturn list;\r\n\t}\r\n\r\n\tisShownInList() {\r\n\t\treturn Settings.get(`serverlist.show.${this[id]}`, true);\r\n\t}\r\n\r\n\tisShownInPicker() {\r\n\t\treturn Settings.get(`picker.server.show.${this[id]}`, true);\r\n\t}\r\n\r\n\tstatic getCurrentServer() {\r\n\t\treturn GLOBAL_SERVER_LIST.reduce((p, c) => (p || (c.isCurrent() && c)), false) || null;\r\n\t}\r\n\r\n\tstatic getAllServersUnordered() {\r\n\t\treturn GLOBAL_SERVER_LIST;\r\n\t}\r\n\r\n\tstatic getAllServers() {\r\n\t\tif (Settings.get('picker.serversorder', false)) {\r\n\t\t\tconst order = Settings.get('picker.serversorder');\r\n\t\t\treturn GLOBAL_SERVER_LIST.sort((a, b) => order.indexOf(a.id) - order.indexOf(b.id));\r\n\t\t} else {\r\n\t\t\tconst servers = [];\r\n\t\t\tservers.push(...GLOBAL_SERVER_LIST);\r\n\t\t\tSettings.set('picker.serversorder', servers.map(c => c.id));\r\n\t\t\treturn servers;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic getById(id) {\r\n\t\treturn GLOBAL_SERVER_LIST.reduce((p, c) => (p || ((c.id == id) && c)), false) || null;\r\n\t}\r\n}\r\n\r\n// Store \"inbox\" emulation of server\r\nnew Server('@me', '@me', 0x00040000); // eslint-disable-line no-new\r\n\r\nmodule.exports = Server;\r\n",
    "'use strict';\r\n\r\nconst { getClasses } = require('./helpers.js');\r\n\r\nconst {\r\n\tSWITCH_CLASSES,\r\n\tFLEX_CHILD_CLASSES,\r\n\tFLEX_CLASSES,\r\n\tHEADER_CLASSES,\r\n\tSWITCH_ITEM_CLASSES,\r\n\tDIVIDER_ITEM_CLASSES,\r\n\tCARD_CLASSES,\r\n\tSERVER_CARD_CLASSES,\r\n} = require('./classes.js');\r\n\r\nconst Settings = require('./settings.js');\r\n\r\nfunction serverCard(server, iconStorage, onServerChangeState) {\r\n\t//jscs:disable maximumLineLength\r\n\tconst $card = $(`\r\n\t\t<div class=\"be-accordion-item ${CARD_CLASSES.cardPrimary} ${SERVER_CARD_CLASSES.serverCard}\" id=\"server-card-${server.id}\" style=\"padding: 7px\">\r\n\t\t\t<div class=\"be-accordion-title ${getClasses(FLEX_CLASSES, ['horizontal', 'flex', 'justifyStart', 'alignStretch', 'noWrap'])}\">\r\n\t\t\t\t<div class=\"${FLEX_CHILD_CLASSES.flexChild}\" style=\"padding-right: 15px;\">\r\n\t\t\t\t\t<img class=\"${SERVER_CARD_CLASSES.icon}\" src=\"${iconStorage[server.id]}\"/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"${FLEX_CHILD_CLASSES.flexChild} ${FLEX_CLASSES.vertical}\" style=\"width: 60%\">\r\n\t\t\t\t\t<h5 class=\"${FLEX_CHILD_CLASSES.flexChild} ${HEADER_CLASSES.h5} margin-bottom-4\">${server.name}</h5>\r\n\t\t\t\t\t<h5 class=\"${FLEX_CHILD_CLASSES.flexChild} ${HEADER_CLASSES.h5} margin-bottom-4\">Emojis: ${server.emojis.length}, BBTV: ${server.sharedEmojis.length}</h5>\t\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"${FLEX_CHILD_CLASSES.flexChild} ${FLEX_CLASSES.vertical}\" style=\"flex: 1 1 auto;\">\r\n\t\t\t\t\t<div class=\"margin-bottom-4 ${[SERVER_CARD_CLASSES.showInPicker, getClasses(FLEX_CHILD_CLASSES, ['flex', 'horizontal']), getClasses(FLEX_CLASSES, ['justifyStart', 'alignStart', 'noWrap'])].join(' ')}\" style=\"flex: 1 1 auto;\">\r\n\t\t\t\t\t\t<h3 class=\"${[getClasses(HEADER_CLASSES, ['h3', 'defaultColor']),  SWITCH_ITEM_CLASSES.title, FLEX_CHILD_CLASSES.flexChild].join(' ')}\" style=\"flex: 1 1 auto;\">\r\n\t\t\t\t\t\t\tPicker\r\n\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t<div class=\"${SWITCH_CLASSES.switchWrapperDefaultActive} ${FLEX_CHILD_CLASSES.flexChild}\" style=\"flex: 0 0 auto;\">\r\n\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"${SWITCH_CLASSES.checkbox}\" value=\"on\">\r\n\t\t\t\t\t\t\t<div class=\"${SWITCH_CLASSES.switch} ${server.isShownInPicker() ? SWITCH_CLASSES.checked : ''} ${SERVER_CARD_CLASSES.showInPickerSwitch}\"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"margin-bottom-4 ${[SERVER_CARD_CLASSES.showInServerList, getClasses(FLEX_CHILD_CLASSES, ['flex', 'horizontal']), getClasses(FLEX_CLASSES, ['justifyStart', 'alignStart', 'noWrap'])].join(' ')}\" style=\"flex: 1 1 auto;\">\r\n\t\t\t\t\t\t<h3 class=\"${[getClasses(HEADER_CLASSES, ['h3', 'defaultColor']),  SWITCH_ITEM_CLASSES.title, FLEX_CHILD_CLASSES.flexChild].join(' ')}\" style=\"flex: 1 1 auto;\">\r\n\t\t\t\t\t\t\tServer list\r\n\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t<div class=\"${SWITCH_CLASSES.switchWrapperDefaultActive} ${FLEX_CHILD_CLASSES.flexChild}\" style=\"flex: 0 0 auto;\">\r\n\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"${SWITCH_CLASSES.checkbox}\" value=\"on\">\r\n\t\t\t\t\t\t\t<div class=\"${SWITCH_CLASSES.switch} ${server.isShownInList() ? SWITCH_CLASSES.checked : ''} ${SERVER_CARD_CLASSES.showInServerListSwitch}\"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"be-accordion-data\">\r\n\t\t\t\t<div class=\"${DIVIDER_ITEM_CLASSES.divider}\" style=\"margin-top: 4px; margin-bottom: 7px;\"></div>\r\n\t\t\t\t<div class=\"container\">\r\n\t\t\t\t\t<div class=\"be-emoji-container-wrapper\">\r\n\t\t\t\t\t\t<h3 class=\"container-title ${getClasses(HEADER_CLASSES, ['h3', 'defaultColor'])}\">\r\n\t\t\t\t\t\t\tEnabled Emojis\r\n\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t<div class=\"${CARD_CLASSES.cardPrimary} be-emoji-container enabled-emoji-container\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"be-emoji-container-wrapper\" style=\"padding-left:5px\">\r\n\t\t\t\t\t\t<h3 class=\"container-title ${getClasses(HEADER_CLASSES, ['h3', 'defaultColor'])}\">\r\n\t\t\t\t\t\t\tDisabled Emojis\r\n\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t<div class=\"${CARD_CLASSES.cardPrimary} be-emoji-container disabled-emoji-container\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t`); //jscs:enable maximumLineLength\r\n\r\n\tconst $enabledEmojis = $card.find('.enabled-emoji-container');\r\n\tconst $disabledEmojis = $card.find('.disabled-emoji-container');\r\n\tconst $accordionContent = $card.find('.be-accordion-data');\r\n\r\n\tfunction emojiItem(emoji) {\r\n\t\treturn $('<div class=\"be-emoji-item\"></div>')\r\n\t\t\t.css('background-image', `url(\"${emoji.url}\")`)\r\n\t\t\t.data('emoji-id', `${emoji.id}`)\r\n\t\t\t.dblclick(function () {\r\n\t\t\t\tconst $this = $(this).detach();\r\n\r\n\t\t\t\tif (Settings.get(`picker.emoji.enabled.${emoji.id}`, true)) {\r\n\t\t\t\t\t$disabledEmojis.append($this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$enabledEmojis.append($this);\r\n\t\t\t\t}\r\n\r\n\t\t\t\thandleChange();\r\n\t\t\t});\r\n\t}\r\n\r\n\tfunction handleChange() {\r\n\t\t$enabledEmojis\r\n\t\t\t.children()\r\n\t\t\t.map((i, c) => Settings.set(`picker.emoji.enabled.${$(c).data('emoji-id')}`, true));\r\n\t\t$disabledEmojis\r\n\t\t\t.children()\r\n\t\t\t.map((i, c) => Settings.set(`picker.emoji.enabled.${$(c).data('emoji-id')}`, false));\r\n\t}\r\n\r\n\tlet enabledEmojisSortable;\r\n\tlet disabledEmojisSortable;\r\n\r\n\t$enabledEmojis.on('change', handleChange);\r\n\t$disabledEmojis.on('change', handleChange);\r\n\r\n\t$card.data('server-id', server.id);\r\n\r\n\t$card.on('accordion.close', () => {\r\n\t\thandleChange();\r\n\t\t$enabledEmojis.html('');\r\n\t\t$disabledEmojis.html('');\r\n\t\tenabledEmojisSortable.$destroy();\r\n\t\tdisabledEmojisSortable.$destroy();\r\n\t});\r\n\r\n\t$card.on('accordion.open', () => {\r\n\t\tfor (const emoji of server.emojis) {\r\n\t\t\tif (Settings.get(`picker.emoji.enabled.${emoji.id}`, true)) {\r\n\t\t\t\t$enabledEmojis.append(emojiItem(emoji));\r\n\t\t\t} else {\r\n\t\t\t\t$disabledEmojis.append(emojiItem(emoji));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//FIXME sortable shaking while movening element\r\n\t\tenabledEmojisSortable = UIkit.sortable($enabledEmojis, {\r\n\t\t\tgroup: `emoji-sortable-${server.id}`,\r\n\t\t\tanimation: 150,\r\n\t\t\t'cls-base': 'be-emoji-container',\r\n\t\t\t'cls-item': 'be-emoji-item',\r\n\t\t\t'cls-empty': 'be-empty-sortable',\r\n\t\t});\r\n\r\n\t\tdisabledEmojisSortable = UIkit.sortable($disabledEmojis, {\r\n\t\t\tgroup: `emoji-sortable-${server.id}`,\r\n\t\t\tanimation: 150,\r\n\t\t\t'cls-base': 'be-emoji-container',\r\n\t\t\t'cls-item': 'be-emoji-item',\r\n\t\t\t'cls-empty': 'be-empty-sortable',\r\n\t\t});\r\n\t});\r\n\r\n\t$card.find(`.${SERVER_CARD_CLASSES.showInServerList}`).click(function (e) {\r\n\t\te.stopPropagation();\r\n\r\n\t\tconst $switch = $(this).find(`.${SERVER_CARD_CLASSES.showInServerListSwitch}`);\r\n\t\t$switch.toggleClass(SWITCH_CLASSES.checked);\r\n\r\n\t\tconst isShown = $switch.hasClass(SWITCH_CLASSES.checked);\r\n\r\n\t\tSettings.set(`serverlist.show.${server.id}`, isShown);\r\n\r\n\t\tonServerChangeState && onServerChangeState(server, isShown);\r\n\t});\r\n\r\n\t$card.find(`.${SERVER_CARD_CLASSES.showInPicker}`).click(function (e) {\r\n\t\te.stopPropagation();\r\n\r\n\t\tconst $switch = $(this).find(`.${SERVER_CARD_CLASSES.showInPickerSwitch}`);\r\n\t\t$switch.toggleClass(SWITCH_CLASSES.checked);\r\n\r\n\t\tSettings.set(`picker.server.show.${server.id}`, $switch.hasClass(SWITCH_CLASSES.checked));\r\n\t});\r\n\r\n\treturn $card;\r\n}\r\n\r\nmodule.exports = serverCard;\r\n",
    "'use strict';\r\n\r\nconst { getClasses } = require('./helpers.js');\r\n\r\nconst {\r\n\tSETTINGS_CLASSES,\r\n\tSIDEBAR_BUTTON_CLASS,\r\n\tHEADER_CLASSES,\r\n\tSERVER_CARD_CLASSES,\r\n} = require('./classes.js');\r\n\r\nconst { TRANSLATION_MODULE } = require('./constants.js');\r\n\r\nconst Settings = require('./settings.js');\r\nconst Server = require('./server.js');\r\n\r\nconst serverCard = require('./serverCard.js');\r\nconst checkbox = require('./checkbox.js');\r\n\r\nfunction buildSidebarEntry() {\r\n\tconst $entry = $('<span/>');\r\n\r\n\tconst $button = $('<div/>')\r\n\t\t.addClass(SETTINGS_CLASSES.itemDefault)\r\n\t\t.addClass(SIDEBAR_BUTTON_CLASS)\r\n\t\t.html('Better Emojis');\r\n\r\n\t$button.mousedown(function () {\r\n\t\tconst $this = $(this);\r\n\r\n\t\t// Make all selected items unselected\r\n\t\tchangeClasses(SETTINGS_CLASSES.itemBrandSelected, SETTINGS_CLASSES.itemBrand);\r\n\t\tchangeClasses(SETTINGS_CLASSES.itemDefaultSelected, SETTINGS_CLASSES.itemDefault);\r\n\t\tchangeClasses(SETTINGS_CLASSES.itemDangerSelected, SETTINGS_CLASSES.itemDanger);\r\n\r\n\t\t// Make self selected\r\n\t\t$this.removeClass(SETTINGS_CLASSES.itemDefault).addClass(SETTINGS_CLASSES.itemDefaultSelected);\r\n\t});\r\n\r\n\t$entry.append($button).append($('<div/>').addClass(SETTINGS_CLASSES.separator));\r\n\r\n\treturn { $entry, $button };\r\n}\r\n\r\nfunction changeClasses(from, to, parent = null) {\r\n\tconst classes = `.${from.split(' ').join('.')}`;\r\n\treturn (parent == null ? $(classes) : $(parent).find(classes)).removeClass(from).addClass(to);\r\n}\r\n\r\nfunction buildServerCards() {\r\n\tconst guildsIcons = getServersIcons();\r\n\r\n\tconst $serverSortable = $('<div class=\"be-server-sortable\"></div>');\r\n\r\n\tconst servers = Server.getAllServers();\r\n\r\n\tfor (const server of servers) {\r\n\t\tif (server.isGuild())\r\n\t\t\t$serverSortable.append(serverCard(server, guildsIcons, updateHiddenServers));\r\n\t}\r\n\r\n\tconst serversAccordion = UIkit.accordion($serverSortable, {\r\n\t\tduration: 150,\r\n\t\ttargets: '> .be-accordion-item',\r\n\t\ttoggle: '> .be-accordion-title',\r\n\t\tcontent: '> .be-accordion-data',\r\n\t});\r\n\r\n\tUIkit.sortable($serverSortable, {\r\n\t\tanimation: 150,\r\n\t\t'cls-item': SERVER_CARD_CLASSES.serverCard,\r\n\t});\r\n\r\n\t$serverSortable.on('start', function (event, sortable, target, dragged) {\r\n\t\t// console.log(arguments);\r\n\t\tif (target.hasClass('uk-open')) {\r\n\t\t\tserversAccordion.toggle(target, false);\r\n\t\t\tdragged.css({ height: target.outerHeight() });\r\n\t\t}\r\n\t});\r\n\r\n\t$serverSortable.on('beforeshow', function (event, accordion) {\r\n\t\t$(event.target).closest('.be-accordion-item').trigger('accordion.open');\r\n\t});\r\n\r\n\t$serverSortable.on('hidden', function (event, accordion) {\r\n\t\t$(event.target).closest('.be-accordion-item').trigger('accordion.close');\r\n\t});\r\n\r\n\t$serverSortable.on('change', function (event, sortable, target) {\r\n\t\tif (!sortable) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst $children = sortable.$el.children();\r\n\t\tconst out = [];\r\n\t\tout.length = $children.length;\r\n\r\n\t\tfor (let i = 0; i < $children.length; i++) {\r\n\t\t\tout[i] = $($children[i]).data('server-id');\r\n\t\t}\r\n\r\n\t\tSettings.set('picker.serversorder', out);\r\n\t});\r\n\r\n\treturn $serverSortable;\r\n}\r\n\r\nfunction buildContentColumn() {\r\n\tconst $column = $(`\r\n\t<div class=\"content-column default\"><div>\r\n\t\t<div class=\"better-emojis-settings\">\r\n\t\t\t<h2 class=\"${getClasses(HEADER_CLASSES, ['h2', 'defaultColor', 'defaultMarginh2'])}\">\r\n\t\t\t\t\tBetter Emojis\r\n\t\t\t\t</h2>\r\n\t\t\t\t<div class=\"flex-vertical\">\r\n\t\t\t\t\t\r\n\t\t\t\t</div>\r\n\t\t</div>\r\n\t</div></div>\r\n\t`);\r\n\r\n\tconst $contentDiv = $column.find('.flex-vertical');\r\n\r\n\t$contentDiv.append(checkbox({\r\n\t\tsetting: 'enabled',\r\n\t\tname: 'Enabled',\r\n\t\tdescription: 'Enable or disable this plugin',\r\n\t\tvalue: Settings.get('enabled'),\r\n\t\tchange: (value) => {\r\n\t\t\tSettings.set('enabled', value);\r\n\t\t\tupdateHiddenServers();\r\n\t\t}\r\n\t}));\r\n\r\n\t$contentDiv.append(buildServerCards());\r\n\r\n\treturn $column;\r\n}\r\n\r\nconst SERVER_REGEX = /\\/channels\\/(\\d+)\\/\\d+/;\r\nconst BACKGOUND_URL_REGEX = /background-image: url\\(\"(.*)\"\\);/;\r\n\r\nfunction getServersIcons() {\r\n\tconst guildsIcons = {};\r\n\r\n\t$('.guild').map((i, guild) => {\r\n\t\tconst $avatar = $(guild).find('.avatar-small');\r\n\t\tconst match = SERVER_REGEX.exec($avatar.attr('href'));\r\n\r\n\t\tif (!match) {\r\n\t\t\treturn guild;\r\n\t\t}\r\n\r\n\t\tguildsIcons[`${match[1]}`] = BACKGOUND_URL_REGEX.exec($avatar.attr('style'))[1];\r\n\t\treturn guild;\r\n\t});\r\n\r\n\treturn guildsIcons;\r\n}\r\n\r\nfunction injectPanel(layer) {\r\n\tconst $layer = $(layer);\r\n\r\n\tconst { $entry, $button } = buildSidebarEntry();\r\n\tconst $contentColumn = buildContentColumn().hide();\r\n\tconst $contentRegion = $layer.find('.content-region-scroller');\r\n\r\n\t$contentRegion.prepend($contentColumn);\r\n\r\n\t$layer.find('.sidebar > div')\r\n\t\t.children()\r\n\t\t.mousedown(() => {\r\n\t\t\t$contentRegion.find('.content-column').show();\r\n\t\t\t$contentColumn.hide();\r\n\t\t\t$button.removeClass(SETTINGS_CLASSES.itemDefaultSelected).addClass(SETTINGS_CLASSES.itemDefault);\r\n\t\t})\r\n\t\t.filter((index, element) => $(element).text() === TRANSLATION_MODULE.Messages.CHANGE_LOG)\r\n\t\t.before($entry);\r\n\r\n\t$button.mousedown(() => {\r\n\t\t$contentRegion.find('.content-column').hide();\r\n\t\t$contentColumn.show();\r\n\t});\r\n}\r\n\r\nfunction updateHiddenServers() {\r\n\t$('.guild').map((i, guild) => {\r\n\t\tconst $avatar = $(guild).find('.avatar-small');\r\n\t\tconst match = SERVER_REGEX.exec($avatar.attr('href'));\r\n\r\n\t\tif (!match) {\r\n\t\t\treturn guild;\r\n\t\t}\r\n\r\n\t\tconst server = Server.getById(match[1]);\r\n\r\n\t\tif (!server) {\r\n\t\t\tconsole.log(match);\r\n\t\t\treturn guild;\r\n\t\t}\r\n\r\n\t\tif (server.isShownInList() || !Settings.get('enabled', true)) {\r\n\t\t\t$(guild).removeAttr('style');\r\n\t\t} else {\r\n\t\t\t$(guild).animate({ width: 0, height: 0 }, 500, 'swing', function () {\r\n\t\t\t\t$(this).hide();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn guild;\r\n\t});\r\n}\r\n\r\nexports.updateHiddenServers = updateHiddenServers;\r\n\r\nexports.inject = injectPanel;\r\n",
    "'use strict';\r\n\r\nconst {\r\n\tLOCAL_STORAGE_MODULE,\r\n\tBETTER_EMOJIS_KEY,\r\n} = require('./constants.js');\r\n\r\n//FIXME empty object returned for require('fs')\r\nconst fs = require('fs');\r\nconst path = require('path');\r\n\r\nconst defaultSettings = { enabled: true };\r\n\r\nconst SETTINGS_HANDLER = {\r\n\tget: function (target, name) {\r\n\t\tif (typeof name !== 'string') {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tconst path = name.split('.');\r\n\t\tif (!path.every(e => !!e)) {\r\n\t\t\tthrow Error(`Invalid settings path: ${name}`);\r\n\t\t}\r\n\r\n\t\tlet obj = target;\r\n\r\n\t\tfor (const prop of path) {\r\n\t\t\tobj = obj[prop];\r\n\r\n\t\t\tif (!obj) {\r\n\t\t\t\treturn obj;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn obj;\r\n\t},\r\n\r\n\tset: function (target, name, value) {\r\n\r\n\t\tif (typeof name !== 'string' || !name) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\tconst path = name.split('.');\r\n\t\tif (!path.every(e => !!e)) {\r\n\t\t\tthrow Error(`Invalid settings path: ${name}`);\r\n\t\t}\r\n\r\n\t\tconst lastKey = path.pop();\r\n\t\tlet obj = target;\r\n\r\n\t\tfor (const prop of path) {\r\n\t\t\tif (!obj[prop]) {\r\n\t\t\t\tobj[prop] = {};\r\n\t\t\t}\r\n\r\n\t\t\tobj = obj[prop];\r\n\t\t}\r\n\r\n\t\tobj[lastKey] = value;\r\n\r\n\t\treturn true;\r\n\t}\r\n};\r\n\r\nconst fileLocation =\r\n\ttypeof window.betterEmojiLocation !== 'undefined' &&\r\n\tfs.readFileSync && fs.writeFileSync && path.resolve ?\r\n\tpath.resolve(window.betterEmojiLocation, 'config.json') : null;\r\n\r\nconst settings = new Proxy(Object.assign(defaultSettings, loadSettings()), SETTINGS_HANDLER);\r\n\r\nfunction loadSettings() {\r\n\ttry {\r\n\t\treturn JSON.parse(fs.readFileSync(path.resolve(fileLocation, 'config.json'), 'utf-8'));\r\n\t} catch (err) {\r\n\t\tconsole.log('Error loading settings from file:', err);\r\n\t\treturn JSON.parse(LOCAL_STORAGE_MODULE.impl.get(BETTER_EMOJIS_KEY));\r\n\t}\r\n}\r\n\r\nfunction saveSettings() {\r\n\tif (fileLocation) {\r\n\t\tfs.writeFileSync(path.resolve(fileLocation, 'config.json'), JSON.stringify(settings, null, '\\t'));\r\n\t} else {\r\n\t\tLOCAL_STORAGE_MODULE.impl.set(BETTER_EMOJIS_KEY, JSON.stringify(settings));\r\n\t}\r\n}\r\n\r\nexports.set = function (key, value) {\r\n\tsettings[key] = value;\r\n\tsaveSettings();\r\n};\r\n\r\nfunction valueOrDefault(value, def) {\r\n\tif (value === null || typeof value === 'undefined') {\r\n\t\treturn def;\r\n\t}\r\n\r\n\treturn value;\r\n}\r\n\r\nwindow.beSettings = exports;\r\n\r\nexports.get = function (key, def) {\r\n\treturn valueOrDefault(settings[key], def);\r\n};\r\n"
  ]
}